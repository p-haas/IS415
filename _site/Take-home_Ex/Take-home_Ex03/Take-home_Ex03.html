<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Pierre HAAS">
<meta name="dcterms.date" content="2023-03-07">

<title>IS415 - Predicting HDB Public Housing Resale Prices using Geographically Weighted Methods</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">IS415</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Hands-on Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercise">    
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex01/Hands-on_Ex01.html">
 <span class="dropdown-text">Hands-on Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex03/Hands-on_Ex03.html">
 <span class="dropdown-text">Hands-on Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex04/Hands-on_Ex04.html">
 <span class="dropdown-text">Hands-on Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex05/Hands-on_Ex05.html">
 <span class="dropdown-text">Hands-on Exercise 5</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">In-Class Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercises">    
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex02/In-class_Ex02.html">
 <span class="dropdown-text">In-Class Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex03/In-class_Ex03.html">
 <span class="dropdown-text">In-Class Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex04/In-class_Ex04.html">
 <span class="dropdown-text">In-Class Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex05/In-class_Ex05.html">
 <span class="dropdown-text">In-Class Exercise 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex06/In-class_Ex06.html">
 <span class="dropdown-text">In-Class Exercise 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex07/In-class_Ex07.html">
 <span class="dropdown-text">In-Class Exercise 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex08/In-class_Ex08.html">
 <span class="dropdown-text">In-Class Exercise 8</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex09/In-class_Ex09.html">
 <span class="dropdown-text">In-Class Exercise 9</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex10/In-class_Ex10.html">
 <span class="dropdown-text">In-Class Exercise 10</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex11/In-class_Ex11.html">
 <span class="dropdown-text">In-Class Exercise 11</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex12/In-class_Ex12.html">
 <span class="dropdown-text">In-Class Exercise 12</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Take-home Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercises">    
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex01/Take-home_Ex1.html">
 <span class="dropdown-text">Take-home Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex02/Take-home_Ex02.html">
 <span class="dropdown-text">Take-home Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex03/Take-home_Ex03.html">
 <span class="dropdown-text">Take-home Exercise 3</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#getting-started" id="toc-getting-started" class="nav-link active" data-scroll-target="#getting-started"><span class="toc-section-number">1</span>  Getting Started</a>
  <ul class="collapse">
  <li><a href="#installing-and-loading-packages" id="toc-installing-and-loading-packages" class="nav-link" data-scroll-target="#installing-and-loading-packages"><span class="toc-section-number">1.1</span>  Installing and Loading Packages</a></li>
  <li><a href="#the-data" id="toc-the-data" class="nav-link" data-scroll-target="#the-data"><span class="toc-section-number">1.2</span>  The Data</a></li>
  </ul></li>
  <li><a href="#retrieving-and-importing-the-geospatial-data" id="toc-retrieving-and-importing-the-geospatial-data" class="nav-link" data-scroll-target="#retrieving-and-importing-the-geospatial-data"><span class="toc-section-number">2</span>  Retrieving and Importing the Geospatial Data</a>
  <ul class="collapse">
  <li><a href="#master-plan-2019-with-sub-zones" id="toc-master-plan-2019-with-sub-zones" class="nav-link" data-scroll-target="#master-plan-2019-with-sub-zones"><span class="toc-section-number">2.1</span>  Master Plan 2019 with sub-zones</a></li>
  <li><a href="#mrt-train-stations" id="toc-mrt-train-stations" class="nav-link" data-scroll-target="#mrt-train-stations"><span class="toc-section-number">2.2</span>  MRT Train stations</a></li>
  <li><a href="#bus-stop-locations" id="toc-bus-stop-locations" class="nav-link" data-scroll-target="#bus-stop-locations"><span class="toc-section-number">2.3</span>  Bus Stop Locations</a></li>
  <li><a href="#supermarket-data" id="toc-supermarket-data" class="nav-link" data-scroll-target="#supermarket-data"><span class="toc-section-number">2.4</span>  Supermarket data</a></li>
  <li><a href="#retrieving-the-independent-variables-using-the-onemap-api" id="toc-retrieving-the-independent-variables-using-the-onemap-api" class="nav-link" data-scroll-target="#retrieving-the-independent-variables-using-the-onemap-api"><span class="toc-section-number">2.5</span>  Retrieving the independent variables using the OneMap API</a>
  <ul class="collapse">
  <li><a href="#retrieving-the-api-token-using-the-onemapsgapi-package" id="toc-retrieving-the-api-token-using-the-onemapsgapi-package" class="nav-link" data-scroll-target="#retrieving-the-api-token-using-the-onemapsgapi-package"><span class="toc-section-number">2.5.1</span>  Retrieving the API token using the <em>onemapsgapi</em> package</a></li>
  <li><a href="#using-the-api-to-retrieve-the-variables-available-on-onemap" id="toc-using-the-api-to-retrieve-the-variables-available-on-onemap" class="nav-link" data-scroll-target="#using-the-api-to-retrieve-the-variables-available-on-onemap"><span class="toc-section-number">2.5.2</span>  Using the API to retrieve the variables available on OneMap</a></li>
  <li><a href="#creating-the-variable-list" id="toc-creating-the-variable-list" class="nav-link" data-scroll-target="#creating-the-variable-list"><span class="toc-section-number">2.5.3</span>  Creating the variable list</a></li>
  <li><a href="#retrieving-the-available-variables-with-the-onemap-api" id="toc-retrieving-the-available-variables-with-the-onemap-api" class="nav-link" data-scroll-target="#retrieving-the-available-variables-with-the-onemap-api"><span class="toc-section-number">2.5.4</span>  Retrieving the available variables with the OneMap API</a></li>
  <li><a href="#transforming-the-data-frame-to-sf-data-frame" id="toc-transforming-the-data-frame-to-sf-data-frame" class="nav-link" data-scroll-target="#transforming-the-data-frame-to-sf-data-frame"><span class="toc-section-number">2.5.5</span>  Transforming the data frame to sf data frame</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#retrieving-and-importing-the-aspatial-data" id="toc-retrieving-and-importing-the-aspatial-data" class="nav-link" data-scroll-target="#retrieving-and-importing-the-aspatial-data"><span class="toc-section-number">3</span>  Retrieving and Importing the Aspatial Data</a>
  <ul class="collapse">
  <li><a href="#resale-price-of-hdb-flats" id="toc-resale-price-of-hdb-flats" class="nav-link" data-scroll-target="#resale-price-of-hdb-flats"><span class="toc-section-number">3.1</span>  Resale Price of HDB flats</a>
  <ul class="collapse">
  <li><a href="#selecting-trasactions-of-3-room-apartments-from-2021-onwards" id="toc-selecting-trasactions-of-3-room-apartments-from-2021-onwards" class="nav-link" data-scroll-target="#selecting-trasactions-of-3-room-apartments-from-2021-onwards"><span class="toc-section-number">3.1.1</span>  Selecting trasactions of 3 Room apartments from 2021 onwards</a></li>
  <li><a href="#transforming-the-storey_range-column-to-dummy-variables" id="toc-transforming-the-storey_range-column-to-dummy-variables" class="nav-link" data-scroll-target="#transforming-the-storey_range-column-to-dummy-variables"><span class="toc-section-number">3.1.2</span>  Transforming the storey_range column to dummy variables</a></li>
  <li><a href="#transforming-the-flat_model-column-to-dummy-variables" id="toc-transforming-the-flat_model-column-to-dummy-variables" class="nav-link" data-scroll-target="#transforming-the-flat_model-column-to-dummy-variables"><span class="toc-section-number">3.1.3</span>  Transforming the flat_model column to dummy variables</a></li>
  <li><a href="#transforming-the-remaining_lease-to-a-numerical-variable" id="toc-transforming-the-remaining_lease-to-a-numerical-variable" class="nav-link" data-scroll-target="#transforming-the-remaining_lease-to-a-numerical-variable"><span class="toc-section-number">3.1.4</span>  Transforming the remaining_lease to a numerical variable</a></li>
  <li><a href="#geocoding-the-address" id="toc-geocoding-the-address" class="nav-link" data-scroll-target="#geocoding-the-address"><span class="toc-section-number">3.1.5</span>  Geocoding the address</a></li>
  <li><a href="#dropping-the-irrelevant-variables" id="toc-dropping-the-irrelevant-variables" class="nav-link" data-scroll-target="#dropping-the-irrelevant-variables"><span class="toc-section-number">3.1.6</span>  Dropping the irrelevant variables</a></li>
  <li><a href="#creating-the-sf-geometry" id="toc-creating-the-sf-geometry" class="nav-link" data-scroll-target="#creating-the-sf-geometry"><span class="toc-section-number">3.1.7</span>  Creating the sf geometry</a></li>
  </ul></li>
  <li><a href="#primary-school-data" id="toc-primary-school-data" class="nav-link" data-scroll-target="#primary-school-data"><span class="toc-section-number">3.2</span>  Primary School data</a>
  <ul class="collapse">
  <li><a href="#scrapping-primary-schools-online-with-rvest-package" id="toc-scrapping-primary-schools-online-with-rvest-package" class="nav-link" data-scroll-target="#scrapping-primary-schools-online-with-rvest-package"><span class="toc-section-number">3.2.1</span>  Scrapping Primary Schools online with <em>rvest</em> package</a></li>
  <li><a href="#using-the-onemap-api-to-retrieve-the-schools-coordinates" id="toc-using-the-onemap-api-to-retrieve-the-schools-coordinates" class="nav-link" data-scroll-target="#using-the-onemap-api-to-retrieve-the-schools-coordinates"><span class="toc-section-number">3.2.2</span>  Using the OneMap API to retrieve the schools’ coordinates</a></li>
  <li><a href="#checking-for-missing-information" id="toc-checking-for-missing-information" class="nav-link" data-scroll-target="#checking-for-missing-information"><span class="toc-section-number">3.2.3</span>  Checking for missing information</a></li>
  <li><a href="#creating-the-sf-data-frame-1" id="toc-creating-the-sf-data-frame-1" class="nav-link" data-scroll-target="#creating-the-sf-data-frame-1"><span class="toc-section-number">3.2.4</span>  Creating the sf data frame</a></li>
  <li><a href="#visualizing-the-data-5" id="toc-visualizing-the-data-5" class="nav-link" data-scroll-target="#visualizing-the-data-5"><span class="toc-section-number">3.2.5</span>  Visualizing the data</a></li>
  <li><a href="#creating-a-field-with-the-top-20-primary-schools" id="toc-creating-a-field-with-the-top-20-primary-schools" class="nav-link" data-scroll-target="#creating-a-field-with-the-top-20-primary-schools"><span class="toc-section-number">3.2.6</span>  Creating a field with the Top 20 Primary Schools</a></li>
  </ul></li>
  <li><a href="#shopping-mall-data" id="toc-shopping-mall-data" class="nav-link" data-scroll-target="#shopping-mall-data"><span class="toc-section-number">3.3</span>  Shopping Mall data</a>
  <ul class="collapse">
  <li><a href="#scraping-wikipedia-to-extract-the-list-of-malls-in-singapore" id="toc-scraping-wikipedia-to-extract-the-list-of-malls-in-singapore" class="nav-link" data-scroll-target="#scraping-wikipedia-to-extract-the-list-of-malls-in-singapore"><span class="toc-section-number">3.3.1</span>  Scraping Wikipedia to extract the list of malls in Singapore</a></li>
  <li><a href="#using-the-onemap-api-to-retrieve-the-malls-coordinates" id="toc-using-the-onemap-api-to-retrieve-the-malls-coordinates" class="nav-link" data-scroll-target="#using-the-onemap-api-to-retrieve-the-malls-coordinates"><span class="toc-section-number">3.3.2</span>  Using the OneMap API to retrieve the malls’ coordinates</a></li>
  <li><a href="#filling-missing-information-with-ggmap" id="toc-filling-missing-information-with-ggmap" class="nav-link" data-scroll-target="#filling-missing-information-with-ggmap"><span class="toc-section-number">3.3.3</span>  Filling missing information with ggmap</a></li>
  <li><a href="#filling-missing-information-manually" id="toc-filling-missing-information-manually" class="nav-link" data-scroll-target="#filling-missing-information-manually"><span class="toc-section-number">3.3.4</span>  Filling missing information manually</a></li>
  <li><a href="#creating-an-sf-data-frame" id="toc-creating-an-sf-data-frame" class="nav-link" data-scroll-target="#creating-an-sf-data-frame"><span class="toc-section-number">3.3.5</span>  Creating an sf data frame</a></li>
  <li><a href="#visualizing-the-data-6" id="toc-visualizing-the-data-6" class="nav-link" data-scroll-target="#visualizing-the-data-6"><span class="toc-section-number">3.3.6</span>  Visualizing the data</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#preparing-the-final-data-frame" id="toc-preparing-the-final-data-frame" class="nav-link" data-scroll-target="#preparing-the-final-data-frame"><span class="toc-section-number">4</span>  Preparing the final data frame</a>
  <ul class="collapse">
  <li><a href="#proximity-variables" id="toc-proximity-variables" class="nav-link" data-scroll-target="#proximity-variables"><span class="toc-section-number">4.1</span>  Proximity variables</a>
  <ul class="collapse">
  <li><a href="#proximity-to-cbd" id="toc-proximity-to-cbd" class="nav-link" data-scroll-target="#proximity-to-cbd"><span class="toc-section-number">4.1.1</span>  Proximity to CBD</a></li>
  <li><a href="#proximity-to-eldercare" id="toc-proximity-to-eldercare" class="nav-link" data-scroll-target="#proximity-to-eldercare"><span class="toc-section-number">4.1.2</span>  Proximity to eldercare</a></li>
  <li><a href="#proximity-to-food-court-hawker-centres" id="toc-proximity-to-food-court-hawker-centres" class="nav-link" data-scroll-target="#proximity-to-food-court-hawker-centres"><span class="toc-section-number">4.1.3</span>  Proximity to food court / hawker centres</a></li>
  <li><a href="#proximity-to-mrt" id="toc-proximity-to-mrt" class="nav-link" data-scroll-target="#proximity-to-mrt"><span class="toc-section-number">4.1.4</span>  Proximity to MRT</a></li>
  <li><a href="#proximity-to-park" id="toc-proximity-to-park" class="nav-link" data-scroll-target="#proximity-to-park"><span class="toc-section-number">4.1.5</span>  Proximity to park</a></li>
  <li><a href="#proximity-to-good-primary-school" id="toc-proximity-to-good-primary-school" class="nav-link" data-scroll-target="#proximity-to-good-primary-school"><span class="toc-section-number">4.1.6</span>  Proximity to good primary school</a></li>
  <li><a href="#proximity-to-shopping-mall" id="toc-proximity-to-shopping-mall" class="nav-link" data-scroll-target="#proximity-to-shopping-mall"><span class="toc-section-number">4.1.7</span>  Proximity to shopping mall</a></li>
  <li><a href="#proximity-to-supermarket" id="toc-proximity-to-supermarket" class="nav-link" data-scroll-target="#proximity-to-supermarket"><span class="toc-section-number">4.1.8</span>  Proximity to supermarket</a></li>
  </ul></li>
  <li><a href="#number-of-within-given-distance" id="toc-number-of-within-given-distance" class="nav-link" data-scroll-target="#number-of-within-given-distance"><span class="toc-section-number">4.2</span>  Number of … within given distance</a>
  <ul class="collapse">
  <li><a href="#numbers-of-kindergartens-within-350m" id="toc-numbers-of-kindergartens-within-350m" class="nav-link" data-scroll-target="#numbers-of-kindergartens-within-350m"><span class="toc-section-number">4.2.1</span>  Numbers of kindergartens within 350m</a></li>
  <li><a href="#numbers-of-childcare-centres-within-350m" id="toc-numbers-of-childcare-centres-within-350m" class="nav-link" data-scroll-target="#numbers-of-childcare-centres-within-350m"><span class="toc-section-number">4.2.2</span>  Numbers of childcare centres within 350m</a></li>
  <li><a href="#numbers-of-bus-stop-within-350m" id="toc-numbers-of-bus-stop-within-350m" class="nav-link" data-scroll-target="#numbers-of-bus-stop-within-350m"><span class="toc-section-number">4.2.3</span>  Numbers of bus stop within 350m</a></li>
  <li><a href="#numbers-of-primary-school-within-1km" id="toc-numbers-of-primary-school-within-1km" class="nav-link" data-scroll-target="#numbers-of-primary-school-within-1km"><span class="toc-section-number">4.2.4</span>  Numbers of primary school within 1km</a></li>
  </ul></li>
  <li><a href="#saving-the-data" id="toc-saving-the-data" class="nav-link" data-scroll-target="#saving-the-data"><span class="toc-section-number">4.3</span>  Saving the data</a></li>
  <li><a href="#check-for-missing-data" id="toc-check-for-missing-data" class="nav-link" data-scroll-target="#check-for-missing-data"><span class="toc-section-number">4.4</span>  Check for missing data</a></li>
  </ul></li>
  <li><a href="#hedonic-pricing-model" id="toc-hedonic-pricing-model" class="nav-link" data-scroll-target="#hedonic-pricing-model"><span class="toc-section-number">5</span>  Hedonic Pricing model</a>
  <ul class="collapse">
  <li><a href="#splitting-the-data" id="toc-splitting-the-data" class="nav-link" data-scroll-target="#splitting-the-data"><span class="toc-section-number">5.1</span>  Splitting the data</a></li>
  </ul></li>
  <li><a href="#conventional-ols-method" id="toc-conventional-ols-method" class="nav-link" data-scroll-target="#conventional-ols-method"><span class="toc-section-number">6</span>  Conventional OLS method</a>
  <ul class="collapse">
  <li><a href="#multicollinearity" id="toc-multicollinearity" class="nav-link" data-scroll-target="#multicollinearity"><span class="toc-section-number">6.1</span>  Multicollinearity</a></li>
  <li><a href="#mlr-model" id="toc-mlr-model" class="nav-link" data-scroll-target="#mlr-model"><span class="toc-section-number">6.2</span>  MLR model</a></li>
  <li><a href="#linearity" id="toc-linearity" class="nav-link" data-scroll-target="#linearity"><span class="toc-section-number">6.3</span>  Linearity</a></li>
  <li><a href="#heteroscedasticity" id="toc-heteroscedasticity" class="nav-link" data-scroll-target="#heteroscedasticity"><span class="toc-section-number">6.4</span>  Heteroscedasticity</a></li>
  </ul></li>
  <li><a href="#gwr-methods" id="toc-gwr-methods" class="nav-link" data-scroll-target="#gwr-methods"><span class="toc-section-number">7</span>  GWR methods</a>
  <ul class="collapse">
  <li><a href="#converting-sf-data-frame-to-spatialpointdataframe" id="toc-converting-sf-data-frame-to-spatialpointdataframe" class="nav-link" data-scroll-target="#converting-sf-data-frame-to-spatialpointdataframe"><span class="toc-section-number">7.1</span>  Converting sf data frame to SpatialPointDataFrame</a>
  <ul class="collapse">
  <li><a href="#computing-adaptive-bandwidth" id="toc-computing-adaptive-bandwidth" class="nav-link" data-scroll-target="#computing-adaptive-bandwidth"><span class="toc-section-number">7.1.1</span>  Computing adaptive bandwidth</a></li>
  <li><a href="#constructing-the-adaptive-bandwidth-gwr-model" id="toc-constructing-the-adaptive-bandwidth-gwr-model" class="nav-link" data-scroll-target="#constructing-the-adaptive-bandwidth-gwr-model"><span class="toc-section-number">7.1.2</span>  Constructing the adaptive bandwidth gwr model</a></li>
  </ul></li>
  <li><a href="#dropping-geometry" id="toc-dropping-geometry" class="nav-link" data-scroll-target="#dropping-geometry"><span class="toc-section-number">7.2</span>  Dropping geometry</a></li>
  <li><a href="#calibrating-random-forest-model" id="toc-calibrating-random-forest-model" class="nav-link" data-scroll-target="#calibrating-random-forest-model"><span class="toc-section-number">7.3</span>  Calibrating Random Forest Model</a></li>
  <li><a href="#calibrating-geographical-random-forest-model" id="toc-calibrating-geographical-random-forest-model" class="nav-link" data-scroll-target="#calibrating-geographical-random-forest-model"><span class="toc-section-number">7.4</span>  Calibrating Geographical Random Forest Model</a>
  <ul class="collapse">
  <li><a href="#calibrating-using-training-data" id="toc-calibrating-using-training-data" class="nav-link" data-scroll-target="#calibrating-using-training-data"><span class="toc-section-number">7.4.1</span>  Calibrating using training data</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#testing" id="toc-testing" class="nav-link" data-scroll-target="#testing"><span class="toc-section-number">8</span>  Testing</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Predicting HDB Public Housing Resale Prices using Geographically Weighted Methods</h1>
<p class="subtitle lead">Take-home Exercise 3</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Pierre HAAS </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 7, 2023</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">March 26, 2023</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="getting-started" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Getting Started</h1>
<p>In this Take-home Exercise 3, we will try using geographically weighted methods to predict the resale price of HDB public housing in Singapore. You will find in the next to sections a brief description of the data sets used and where to retrieve them as well as the list of all the libraries needed for this project and a description of their specific usage.</p>
<section id="installing-and-loading-packages" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="installing-and-loading-packages"><span class="header-section-number">1.1</span> Installing and Loading Packages</h2>
<p>For the purpose our this project, we have selected a list of libraries that will allow to perform all the necessary data cleaning, handling and analysis.</p>
<p>The following list shows the libraries that will be used and their purpose for this assignment:</p>
<ul>
<li><p>pacman</p></li>
<li><p>tidyverse</p></li>
<li><p>janitor</p></li>
<li><p>sf</p></li>
<li><p>spdep</p></li>
<li><p>tmap</p></li>
<li><p>corrplot</p></li>
<li><p>olsrr</p></li>
<li><p>gtsummary</p></li>
<li><p>knitr</p></li>
<li><p>httr</p></li>
<li><p>onemapsapi</p></li>
<li><p>xml2</p></li>
<li><p>rvest</p></li>
<li><p>stringr</p></li>
<li><p>ggmap</p></li>
<li><p>ggpubr</p></li>
<li><p>GWmodel</p></li>
<li><p>SpatialML</p></li>
<li><p>Metrics</p></li>
<li><p>rsample</p></li>
</ul>
<p>To install and load the packages, we use the p_load() function of the pacman package. It automatically checks if packages are installed, installs them if they are not installed, and loads the packages into the R environment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(olsrr, corrplot, ggpubr, sf, spdep,</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>               GWmodel, tmap, tidyverse, gtsummary,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>               ranger, SpatialML, rsample, Metrics,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>               janitor, stargazer, lmtest, robustbase)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(knitr, httr, onemapsgapi, xml2, rvest,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>               stringr, ggmap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">digits =</span> <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-data" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="the-data"><span class="header-section-number">1.2</span> The Data</h2>
<p>For the purpose of this assignment, extensive amount of data was extracted from the web. You will find below a table that directs you to the webpage on which you can retrieve the data sets.</p>
</section>
</section>
<section id="retrieving-and-importing-the-geospatial-data" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Retrieving and Importing the Geospatial Data</h1>
<p>In this first section that addresses the data import, we will be going through the necessary work to load the geospatial data correctly into our R environment.</p>
<p>Note that in this section, we will be load data previously retrieved from the web, but also using some APIs to collect necessary variables that will play an important role in our regression models.</p>
<section id="master-plan-2019-with-sub-zones" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="master-plan-2019-with-sub-zones"><span class="header-section-number">2.1</span> Master Plan 2019 with sub-zones</h2>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Importing the data</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Visualizing the data</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>The first geospatial data set that we are importing is the 2019 Master Plan with sub-zones. Since it is a shp file, we use the st_read() function of the sf package to properly import the data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>mpsz.sf <span class="ot">=</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/geospatial/mpsz2019"</span>,</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">layer =</span> <span class="st">"MPSZ-2019"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `MPSZ-2019' from data source 
  `C:\p-haas\IS415\Take-home_Ex\Take-home_Ex03\data\geospatial\mpsz2019' 
  using driver `ESRI Shapefile'
Simple feature collection with 332 features and 6 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 103.605700705134 ymin: 1.15869870063517 xmax: 104.088483065163 ymax: 1.47077483208461
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
<p>The import was successful, however, before moving on I would like to check if all geometries are valid, and also if the projection code is correectly encoded.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">st_is_valid</span>(mpsz.sf) <span class="sc">==</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>It seems like we have invalid geometries. Now, let’s check the CRS code of the data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(mpsz.sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: WGS 84 
  wkt:
GEOGCRS["WGS 84",
    DATUM["World Geodetic System 1984",
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["latitude",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["longitude",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    ID["EPSG",4326]]</code></pre>
</div>
</div>
<p>It looks like the EPSG and coordinate system does not correspond to the Singaporean SVY21. So, we will change that. We pipe the st_transform() and st_make_valid() functions to solve the two issues we had just pointed out.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>mpsz.sf <span class="ot">=</span> mpsz.sf <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">st_is_valid</span>(mpsz.sf) <span class="sc">==</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(mpsz.sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: EPSG:3414 
  wkt:
PROJCRS["SVY21 / Singapore TM",
    BASEGEOGCRS["SVY21",
        DATUM["SVY21",
            ELLIPSOID["WGS 84",6378137,298.257223563,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4757]],
    CONVERSION["Singapore Transverse Mercator",
        METHOD["Transverse Mercator",
            ID["EPSG",9807]],
        PARAMETER["Latitude of natural origin",1.36666666666667,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",103.833333333333,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",1,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",28001.642,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",38744.572,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["northing (N)",north,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["easting (E)",east,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    USAGE[
        SCOPE["Cadastre, engineering survey, topographic mapping."],
        AREA["Singapore - onshore and offshore."],
        BBOX[1.13,103.59,1.47,104.07]],
    ID["EPSG",3414]]</code></pre>
</div>
</div>
<p>The two issues seem to be solved. Note that I show you how to proceed when importing geospatial data here but will not do so in such an extensive manner later. My goal here is to show you how to replicate my way of proceeding when handling the data for the first time. To make the reading easier, I have cut out all my exploration of this webpage and left only the essential and necessary code.</p>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>Using the qtm() function of the tmap package, we can make a quick visualization of the geometry stored in the sf data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qtm</span>(mpsz.sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="mrt-train-stations" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="mrt-train-stations"><span class="header-section-number">2.2</span> MRT Train stations</h2>
<p>Importing MRT Exits into an sf data frame.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Importing the data</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Visualizing the data</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p>As explained just before, I will be sticking with the necessary code only from now on. Using the following code chunk, we import the MRT Train Stations into an sf data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>mrt_exits.sf <span class="ot">=</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/geospatial/TrainStationExit/TrainStationExit"</span>,</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">layer =</span> <span class="st">"Train_Station_Exit_Layer"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `Train_Station_Exit_Layer' from data source 
  `C:\p-haas\IS415\Take-home_Ex\Take-home_Ex03\data\geospatial\TrainStationExit\TrainStationExit' 
  using driver `ESRI Shapefile'
Simple feature collection with 562 features and 2 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 6134.08550000004 ymin: 27499.6967999991 xmax: 45356.3619999997 ymax: 47865.9227000009
Projected CRS: SVY21</code></pre>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>Using the tmap package, we can conveniently plot the MRT Exits on the Singaporean map.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz.sf)<span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>()<span class="sc">+</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mrt_exits.sf)<span class="sc">+</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="bus-stop-locations" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="bus-stop-locations"><span class="header-section-number">2.3</span> Bus Stop Locations</h2>
<p>Importing Bus Stops into an sf data frame.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Importing the data</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Visualizing the data</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>bus_stops.sf <span class="ot">=</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/geospatial/BusStopLocation/BusStop_Feb2023"</span>,</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">layer =</span> <span class="st">"BusStop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `BusStop' from data source 
  `C:\p-haas\IS415\Take-home_Ex\Take-home_Ex03\data\geospatial\BusStopLocation\BusStop_Feb2023' 
  using driver `ESRI Shapefile'
Simple feature collection with 5159 features and 3 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 3970.12161372974 ymin: 26482.1007183008 xmax: 48284.5630137296 ymax: 52983.8165183011
Projected CRS: SVY21</code></pre>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz.sf)<span class="sc">+</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>()<span class="sc">+</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(bus_stops.sf)<span class="sc">+</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="supermarket-data" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="supermarket-data"><span class="header-section-number">2.4</span> Supermarket data</h2>
<p>Importing Supermarket Locations into an sf data frame.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">Importing the data</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Visualizing the data</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>supermarkets.sf <span class="ot">=</span> <span class="fu">st_read</span>(<span class="st">"data/geospatial/supermarkets/supermarkets-kml.kml"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `SUPERMARKETS' from data source 
  `C:\p-haas\IS415\Take-home_Ex\Take-home_Ex03\data\geospatial\supermarkets\supermarkets-kml.kml' 
  using driver `KML'
Simple feature collection with 526 features and 2 fields
Geometry type: POINT
Dimension:     XYZ
Bounding box:  xmin: 103.625764663231 ymin: 1.2471504063107 xmax: 104.003578458884 ymax: 1.46152554782754
z_range:       zmin: 0 zmax: 0
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz.sf)<span class="sc">+</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>()<span class="sc">+</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(supermarkets.sf)<span class="sc">+</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="retrieving-the-independent-variables-using-the-onemap-api" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="retrieving-the-independent-variables-using-the-onemap-api"><span class="header-section-number">2.5</span> Retrieving the independent variables using the OneMap API</h2>
<p>We will be using the One Map Singapore API to retrieve some of the independent variables that we will be using later on in our regression model.</p>
<p>We will be taking a few preliminary steps before extracting the variables. You will find everything you need to replicate my work in the following sections.</p>
<section id="retrieving-the-api-token-using-the-onemapsgapi-package" class="level3" data-number="2.5.1">
<h3 data-number="2.5.1" class="anchored" data-anchor-id="retrieving-the-api-token-using-the-onemapsgapi-package"><span class="header-section-number">2.5.1</span> Retrieving the API token using the <em>onemapsgapi</em> package</h3>
<p>The first step to getting the API key is to create an account on the One Map website (click <a href="https://www.onemap.gov.sg/docs/#register-free-account">here</a> to access the registration tutorial).</p>
<p>Now that you are registered, we may retrieve the API key using the <em>onemapsgapi</em> package and its get_token() function. By simply entering your registration email and password, you will get a valid API key for a three-day period.</p>
<p>Note that if you want to learn more about the One Map API, you should definitely check their <a href="https://www.onemap.gov.sg/docs/">website</a> and their <a href="https://app.swaggerhub.com/apis/onemap-sg/new-onemap-api/1.0.4">web app</a> that allows to test the API’s services.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>token_api <span class="ot">=</span> <span class="fu">get_token</span>(<span class="at">email =</span> <span class="st">"xxx@xxx.xxx"</span>, </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">password =</span> <span class="st">"..."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="using-the-api-to-retrieve-the-variables-available-on-onemap" class="level3" data-number="2.5.2">
<h3 data-number="2.5.2" class="anchored" data-anchor-id="using-the-api-to-retrieve-the-variables-available-on-onemap"><span class="header-section-number">2.5.2</span> Using the API to retrieve the variables available on OneMap</h3>
<p>The first step to retrieving our independent variables is to look at the available data provided by One Map. We do so using the httr package that allows us to make HTML queries. Using the GET() function, we retrieve every theme info of the OneMap API.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">=</span> <span class="st">"https://developers.onemap.sg/privateapi/themesvc/getAllThemesInfo"</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>query <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"token"</span> <span class="ot">=</span> token_api)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">GET</span>(url, <span class="at">query =</span> query)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using the content() function, we may look at the information retrieved, however, you should be made aware that the result from our GET() command is quite messy. So, you will see in the next section how we extract the theme names and store them into a list.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">content</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="creating-the-variable-list" class="level3" data-number="2.5.3">
<h3 data-number="2.5.3" class="anchored" data-anchor-id="creating-the-variable-list"><span class="header-section-number">2.5.3</span> Creating the variable list</h3>
<p>As explained, the information retrieved is quite messy. So, we will be storing in a list the essential information that we will use later on.</p>
<p>Using a for loop, I store the theme specific information into a list called themes_list.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>themes_list <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">content</span>(result)<span class="sc">$</span>Theme_Names)){</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  themes_list <span class="ot">=</span> <span class="fu">append</span>(themes_list, <span class="fu">content</span>(result)<span class="sc">$</span>Theme_Names[[i]])</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To take a look at the information stored into our list, you may use the next code chunk. However, since the list is quite long, I won’t print the output/information here and will directly give you a list you the variables I have extracted.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>themes_list</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the next code chunk, you may see the variables that I carefully selected. They give information about: Eldercare Services, Hawker Centres, Food Courts, Parks in Singapore, Kindergartens, and Childcare Centres.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>ind_variables <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"eldercare"</span>, <span class="st">"hawkercentre"</span>, <span class="st">"hawkercentre_new"</span>, <span class="st">"healthier_hawker_centres"</span>, <span class="st">"maxwell_fnb_map"</span>, <span class="st">"healthiercaterers"</span>, <span class="st">"relaxsg"</span>, <span class="st">"nationalparks"</span>, <span class="st">"kindergartens"</span>, <span class="st">"childcare"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I have also picked-up some other interesting variables that may be included later in my regression model to improve the quality of the future model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>extra_variables <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"lta_cycling_paths"</span>, <span class="st">"disability"</span>, <span class="st">"hsgb_fcc"</span>, <span class="st">"sportsg_sport_facilities"</span>, <span class="st">"ssc_sports_facilities"</span>, <span class="st">"wastedisposalsite"</span>, <span class="st">"drainageconstruction"</span>, <span class="st">"cpe_pei_premises"</span>, <span class="st">"sewerageconstruction"</span>, <span class="st">"danger_areas"</span>, <span class="st">"aquaticsg"</span>, <span class="st">"moh_isp_clinics"</span>, <span class="st">"heritagetrees"</span>, <span class="st">"nparks_activity_area"</span>,  <span class="st">"exercisefacilities"</span>, <span class="st">"mha_uav_2015"</span>, <span class="st">"playsg"</span>, <span class="st">"underconstruction_facilities"</span>, <span class="st">"preschools_location"</span>, <span class="st">"hdbcyclingunderconstruction"</span>,  <span class="st">"boundary_5km"</span>,  <span class="st">"hdbluppropunderconstruction"</span>, <span class="st">"parkingstandardszone"</span>, <span class="st">"libraries"</span>, <span class="st">"cyclingpath"</span>, <span class="st">"dengue_cluster"</span>, <span class="st">"greenbuilding"</span>, <span class="st">"nparks_uc_parks"</span>, )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You won’t see these additional variables in my model due to the computing power of my computer. However, I strongly recommend to try an include these potential independent variables to improve the model.</p>
</section>
<section id="retrieving-the-available-variables-with-the-onemap-api" class="level3" data-number="2.5.4">
<h3 data-number="2.5.4" class="anchored" data-anchor-id="retrieving-the-available-variables-with-the-onemap-api"><span class="header-section-number">2.5.4</span> Retrieving the available variables with the OneMap API</h3>
<p>Using the code chunk below, you can retrieve the location name and its coordinates based on the previously created list of variables. We store this information into a data frame to make our use of this data easier</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">data.frame</span>()</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>url <span class="ot">=</span> <span class="st">"https://developers.onemap.sg/privateapi/themesvc/retrieveTheme"</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (x <span class="cf">in</span> ind_variables){</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  query <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"queryName"</span> <span class="ot">=</span> x, <span class="st">"token"</span> <span class="ot">=</span> token_api)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">GET</span>(url, <span class="at">query =</span> query)</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"Start"</span>)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(x)</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">content</span>(result)<span class="sc">$</span>SrchResults)){</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    new_row <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">content</span>(result)<span class="sc">$</span>SrchResults[[i]]<span class="sc">$</span>NAME,</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>                <span class="fu">str_split_fixed</span>(<span class="fu">content</span>(result)<span class="sc">$</span>SrchResults[[i]]<span class="sc">$</span>LatLng, <span class="st">","</span>, <span class="dv">2</span>)[<span class="dv">1</span>],</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>                <span class="fu">str_split_fixed</span>(<span class="fu">content</span>(result)<span class="sc">$</span>SrchResults[[i]]<span class="sc">$</span>LatLng, <span class="st">","</span>, <span class="dv">2</span>)[<span class="dv">2</span>],</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>                <span class="fu">content</span>(result)<span class="sc">$</span>SrchResults[[<span class="dv">1</span>]]<span class="sc">$</span>Theme_Name)</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">=</span> <span class="fu">rbind</span>(df, new_row)</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"location_name"</span>, <span class="st">"lat"</span>, <span class="st">"lon"</span>, <span class="st">"variable_name"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that retrieving the data takes a few minutes, so I took care of exporting the data frame into a csv file to avoid running the previous code chunk multiple times.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(df, <span class="st">"data/geospatial/retrieved_variables.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now have part of our independent variables stored into a csv file that we will import back into our R environment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>retrieved_variables <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"data/geospatial/retrieved_variables.csv"</span>, )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we look back to the variables we chose to retrieve using the One Map API, we had sub-categories to our independent variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(retrieved_variables<span class="sc">$</span>variable_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "eldercare"      "hawker_centres" "parks"          "kindergartens" 
[5] "child_care"    </code></pre>
</div>
</div>
<p>For instance, we have four sub-categories for hawker centres and food courts. We shall simplify our work by renaming these sub-categories under one name only. Using the next code chunk, we may do so.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>retrieved_variables<span class="sc">$</span>variable_name <span class="ot">=</span> <span class="fu">str_replace</span>(retrieved_variables<span class="sc">$</span>variable_name, </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"Eldercare Services"</span>, </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"eldercare"</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>retrieved_variables<span class="sc">$</span>variable_name <span class="ot">=</span> <span class="fu">str_replace</span>(retrieved_variables<span class="sc">$</span>variable_name, </span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"^Hawker Centres$"</span>, </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"hawker_centres"</span>)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>retrieved_variables<span class="sc">$</span>variable_name <span class="ot">=</span> <span class="fu">str_replace</span>(retrieved_variables<span class="sc">$</span>variable_name, </span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"Hawker Centres_New"</span>, </span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"hawker_centres"</span>)</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>retrieved_variables<span class="sc">$</span>variable_name <span class="ot">=</span> <span class="fu">str_replace</span>(retrieved_variables<span class="sc">$</span>variable_name, </span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"Healthier Hawker Centres"</span>, </span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"hawker_centres"</span>)</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>retrieved_variables<span class="sc">$</span>variable_name <span class="ot">=</span> <span class="fu">str_replace</span>(retrieved_variables<span class="sc">$</span>variable_name, </span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"Maxwell Chambers F&amp;B map"</span>, </span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"hawker_centres"</span>)</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>retrieved_variables<span class="sc">$</span>variable_name <span class="ot">=</span> <span class="fu">str_replace</span>(retrieved_variables<span class="sc">$</span>variable_name, </span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"Healthier Caterers"</span>, </span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"hawker_centres"</span>)</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>retrieved_variables<span class="sc">$</span>variable_name <span class="ot">=</span> <span class="fu">str_replace</span>(retrieved_variables<span class="sc">$</span>variable_name, </span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"Parks@SG"</span>, </span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"parks"</span>)</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>retrieved_variables<span class="sc">$</span>variable_name <span class="ot">=</span> <span class="fu">str_replace</span>(retrieved_variables<span class="sc">$</span>variable_name, </span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"Parks"</span>, </span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"parks"</span>)</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>retrieved_variables<span class="sc">$</span>variable_name <span class="ot">=</span> <span class="fu">str_replace</span>(retrieved_variables<span class="sc">$</span>variable_name, </span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"Kindergartens"</span>, </span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"kindergartens"</span>)</span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>retrieved_variables<span class="sc">$</span>variable_name <span class="ot">=</span> <span class="fu">str_replace</span>(retrieved_variables<span class="sc">$</span>variable_name, </span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"Child Care Services"</span>, </span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"child_care"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(retrieved_variables<span class="sc">$</span>variable_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "eldercare"      "hawker_centres" "parks"          "kindergartens" 
[5] "child_care"    </code></pre>
</div>
</div>
<p>We shall now proceed to creating sf objects from the extracted coordinates.</p>
</section>
<section id="transforming-the-data-frame-to-sf-data-frame" class="level3" data-number="2.5.5">
<h3 data-number="2.5.5" class="anchored" data-anchor-id="transforming-the-data-frame-to-sf-data-frame"><span class="header-section-number">2.5.5</span> Transforming the data frame to sf data frame</h3>
<p>Using the st_as_sf() function from the <em>sf</em> package, we can transform our set of coordinates into sf point objects.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>retrieved_variables.sf <span class="ot">=</span> <span class="fu">st_as_sf</span>(retrieved_variables,</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>),</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We shall check if our data points have been correctly transformed by plotting the points on the Singapore map using the <em>tmap</em> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz.sf)<span class="sc">+</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>()<span class="sc">+</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(retrieved_variables.sf)<span class="sc">+</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="retrieving-and-importing-the-aspatial-data" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Retrieving and Importing the Aspatial Data</h1>
<section id="resale-price-of-hdb-flats" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="resale-price-of-hdb-flats"><span class="header-section-number">3.1</span> Resale Price of HDB flats</h2>
<p>After retrieving the resale HDB prices from the data.gov.sg website, I moved the folder into my data folder, it contains all the data sets necessary for our analysis, and more precisely stored it into the aspatial folder.</p>
<p>The downloaded data is stored in a folder called resale-flat-prices, itself containing multiple files. To choose the right file, we can use the base r function list.files() to return a list of the file’s names.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>path <span class="ot">=</span> <span class="st">"data/aspatial/resale-flat-prices"</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>files <span class="ot">=</span> <span class="fu">list.files</span>(path)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>files</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "metadata-resale-flat-prices.txt"                                            
[2] "resale-flat-prices-based-on-approval-date-1990-1999.csv"                    
[3] "resale-flat-prices-based-on-approval-date-2000-feb-2012.csv"                
[4] "resale-flat-prices-based-on-registration-date-from-jan-2015-to-dec-2016.csv"
[5] "resale-flat-prices-based-on-registration-date-from-jan-2017-onwards.csv"    
[6] "resale-flat-prices-based-on-registration-date-from-mar-2012-to-dec-2014.csv"</code></pre>
</div>
</div>
<p>Looking at the above list, it seems clear that we should use file n°5 as it contains the data from 2017 and later. It gives us the intuition that we may need to treat the data and take a subset of data rows within the analysis period (2021 to 2023). We will import the data using the read_csv() function from the readr package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>resale_price <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="at">file =</span> <span class="fu">paste</span>(path, files[<span class="dv">5</span>], <span class="at">sep =</span> <span class="st">"/"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We should take a quick look at the fields contained in the resale_price data frame. We do so using the glimpse() function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(resale_price)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 148,096
Columns: 11
$ month               &lt;chr&gt; "2017-01", "2017-01", "2017-01", "2017-01", "2017-…
$ town                &lt;chr&gt; "ANG MO KIO", "ANG MO KIO", "ANG MO KIO", "ANG MO …
$ flat_type           &lt;chr&gt; "2 ROOM", "3 ROOM", "3 ROOM", "3 ROOM", "3 ROOM", …
$ block               &lt;chr&gt; "406", "108", "602", "465", "601", "150", "447", "…
$ street_name         &lt;chr&gt; "ANG MO KIO AVE 10", "ANG MO KIO AVE 4", "ANG MO K…
$ storey_range        &lt;chr&gt; "10 TO 12", "01 TO 03", "01 TO 03", "04 TO 06", "0…
$ floor_area_sqm      &lt;dbl&gt; 44, 67, 67, 68, 67, 68, 68, 67, 68, 67, 68, 67, 67…
$ flat_model          &lt;chr&gt; "Improved", "New Generation", "New Generation", "N…
$ lease_commence_date &lt;dbl&gt; 1979, 1978, 1980, 1980, 1980, 1981, 1979, 1976, 19…
$ remaining_lease     &lt;chr&gt; "61 years 04 months", "60 years 07 months", "62 ye…
$ resale_price        &lt;dbl&gt; 232000, 250000, 262000, 265000, 265000, 275000, 28…</code></pre>
</div>
</div>
<p>The available fields are as follows:</p>
<ul>
<li>month: it indicates the month of transaction</li>
<li>town: it indicates the district</li>
<li>flat_type: it indicates the number of rooms in the flat</li>
<li>block: it indicates the block number of the HDB flat</li>
<li>street_name: it indicates the street number and name</li>
<li>storey_range: it indicates the floor number of the flat</li>
<li>floor_area_sqm: it indicates the floor area of the flat in square meter</li>
<li>flat_model: it indicates the HDB flat model</li>
<li>lease_commence_date: it indicates the starting year date of the lease (in Singapore, HDB flats are 99-year leaseholds)</li>
<li>remaining_lease: it indicates the remaining years and months on the 99-year leasehold</li>
<li>resale_price: it indicates the resale price of a given flat in SGD (Singapore dollars)</li>
</ul>
<p>Now, we will use the head() function to look at the available data in each field.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(resale_price)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 11
  month   town     flat_…¹ block stree…² store…³ floor…⁴ flat_…⁵ lease…⁶ remai…⁷
  &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;  
1 2017-01 ANG MO … 2 ROOM  406   ANG MO… 10 TO …      44 Improv…    1979 61 yea…
2 2017-01 ANG MO … 3 ROOM  108   ANG MO… 01 TO …      67 New Ge…    1978 60 yea…
3 2017-01 ANG MO … 3 ROOM  602   ANG MO… 01 TO …      67 New Ge…    1980 62 yea…
4 2017-01 ANG MO … 3 ROOM  465   ANG MO… 04 TO …      68 New Ge…    1980 62 yea…
5 2017-01 ANG MO … 3 ROOM  601   ANG MO… 01 TO …      67 New Ge…    1980 62 yea…
6 2017-01 ANG MO … 3 ROOM  150   ANG MO… 01 TO …      68 New Ge…    1981 63 yea…
# … with 1 more variable: resale_price &lt;dbl&gt;, and abbreviated variable names
#   ¹​flat_type, ²​street_name, ³​storey_range, ⁴​floor_area_sqm, ⁵​flat_model,
#   ⁶​lease_commence_date, ⁷​remaining_lease</code></pre>
</div>
</div>
<section id="selecting-trasactions-of-3-room-apartments-from-2021-onwards" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="selecting-trasactions-of-3-room-apartments-from-2021-onwards"><span class="header-section-number">3.1.1</span> Selecting trasactions of 3 Room apartments from 2021 onwards</h3>
<p>My previously mentioned intuition is confirmed. The month variable takes data starting in January 2017 and, through quick data manipulation, we will have to restrain the data frames to the 2021-2022 analysis period and 2023 data testing period. In addition, it looks like the town field in unnecessary and may be dropped. We only need the block and steet_name fields to geocode the addresses and create sf geometry.</p>
<p>Here we pipe the select() function to remove the town variable, filter and grepl functions to create a subset of the data by only selecting transactions that took place in 2021 to 2023, and finally pipe once again the filter function to select only three room HDB flats.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>rp_3rooms <span class="ot">=</span> resale_price <span class="sc">%&gt;%</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"202[123]"</span>, month)) <span class="sc">%&gt;%</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(flat_type <span class="sc">==</span> <span class="st">"3 ROOM"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="transforming-the-storey_range-column-to-dummy-variables" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="transforming-the-storey_range-column-to-dummy-variables"><span class="header-section-number">3.1.2</span> Transforming the storey_range column to dummy variables</h3>
<p>Since we would like to include the storey_range variable in our analysis and the column only takes categorical data, we shall create dummy variables to indicate the storey range of each HDB flat.</p>
<p>The first step is to look at what are the unique values in the column. Using the unique() function, we retrieve in the form of a list the unique categorical values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(rp_3rooms<span class="sc">$</span>storey_range)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "04 TO 06" "01 TO 03" "07 TO 09" "10 TO 12" "13 TO 15" "16 TO 18"
 [7] "19 TO 21" "25 TO 27" "22 TO 24" "37 TO 39" "31 TO 33" "34 TO 36"
[13] "40 TO 42" "46 TO 48" "28 TO 30" "43 TO 45"</code></pre>
</div>
</div>
<p>Now, using a for loop and the ifelse() function, we will create a new column for each unique categorical variable contained in the storey_range field and assign a 1 if the particular HDB flat belongs to the specific storey range.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">unique</span>(rp_3rooms<span class="sc">$</span>storey_range)){</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  rp_3rooms[i] <span class="ot">=</span> <span class="fu">ifelse</span>(rp_3rooms<span class="sc">$</span>storey_range <span class="sc">==</span> i, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="transforming-the-flat_model-column-to-dummy-variables" class="level3" data-number="3.1.3">
<h3 data-number="3.1.3" class="anchored" data-anchor-id="transforming-the-flat_model-column-to-dummy-variables"><span class="header-section-number">3.1.3</span> Transforming the flat_model column to dummy variables</h3>
<p>We repeat the same process with the flat_model variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(rp_3rooms<span class="sc">$</span>flat_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "New Generation"    "Improved"          "Model A"          
[4] "Simplified"        "Standard"          "Premium Apartment"
[7] "DBSS"              "Terrace"          </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">unique</span>(rp_3rooms<span class="sc">$</span>flat_model)){</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  rp_3rooms[i] <span class="ot">=</span> <span class="fu">ifelse</span>(rp_3rooms<span class="sc">$</span>flat_model <span class="sc">==</span> i, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="transforming-the-remaining_lease-to-a-numerical-variable" class="level3" data-number="3.1.4">
<h3 data-number="3.1.4" class="anchored" data-anchor-id="transforming-the-remaining_lease-to-a-numerical-variable"><span class="header-section-number">3.1.4</span> Transforming the remaining_lease to a numerical variable</h3>
<p>If you remember previously when we took a look at the different data fields available in our data frame, you could notice that the remaining_lease variable stored character data, however, we would like it to be a numerical data field.</p>
<p>To transform our column into a numerical field, we use a for loop with if/else statements. This will allow us to extract the number of years and months remaining on the lease and create a variable that stores the years remaining before expiration of the lease.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>lease_remaining <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(rp_3rooms)){</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  lease <span class="ot">=</span> <span class="fu">str_extract_all</span>(rp_3rooms<span class="sc">$</span>remaining_lease, <span class="st">"[0-9]+"</span>)[[i]]</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  year <span class="ot">=</span> <span class="fu">as.numeric</span>(lease[<span class="dv">1</span>])</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(lease) <span class="sc">&lt;</span> <span class="dv">2</span>){</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>    lease_remaining <span class="ot">=</span> <span class="fu">append</span>(lease_remaining, year)</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>    month <span class="ot">=</span> <span class="fu">as.numeric</span>(lease[<span class="dv">2</span>])</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>    lease_remaining <span class="ot">=</span> <span class="fu">append</span>(lease_remaining, <span class="fu">round</span>(year<span class="sc">+</span>month<span class="sc">/</span><span class="dv">12</span>, <span class="dv">2</span>))</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>rp_3rooms<span class="sc">$</span>remaining_lease <span class="ot">=</span> <span class="fu">as.numeric</span>(lease_remaining)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="geocoding-the-address" class="level3" data-number="3.1.5">
<h3 data-number="3.1.5" class="anchored" data-anchor-id="geocoding-the-address"><span class="header-section-number">3.1.5</span> Geocoding the address</h3>
<p>The first step to geocoding the address - retrieving the latitude and longitude based in the address - is to create a new column that stores the cleaned full address. Consequently, we create a new field called cleaned_address that combines both the block and street_name fields. This will allow us to retrieve the geocode of the HDB flats in our query.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>rp_3rooms[<span class="st">"cleaned_address"</span>] <span class="ot">=</span> <span class="fu">paste</span>(rp_3rooms<span class="sc">$</span>block, rp_3rooms<span class="sc">$</span>street_name, <span class="at">sep =</span> <span class="st">" "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that we have a column that stores the cleaned addresses, we can move on to the geocoding. By using the httr package and One Map API, we will create GET requests that retrieve the full address of the HDB flat, its longitude and latitude. We will store all this data into three lists to later create three additional columns in our data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">=</span> <span class="st">"https://developers.onemap.sg/commonapi/search"</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>full_address <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>latitude <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>longitude <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (address <span class="cf">in</span> rp_3rooms<span class="sc">$</span>cleaned_address){</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>  query <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"searchVal"</span> <span class="ot">=</span> address,</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>                <span class="st">"returnGeom"</span> <span class="ot">=</span> <span class="st">"Y"</span>, <span class="st">"getAddrDetails"</span> <span class="ot">=</span> <span class="st">"Y"</span>)</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">GET</span>(url, <span class="at">query =</span> query)</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>  full_address <span class="ot">=</span> <span class="fu">append</span>(full_address, <span class="fu">content</span>(res)<span class="sc">$</span>results[[<span class="dv">1</span>]]<span class="sc">$</span>ADDRESS)</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>  latitude <span class="ot">=</span> <span class="fu">append</span>(latitude, <span class="fu">content</span>(res)<span class="sc">$</span>results[[<span class="dv">1</span>]]<span class="sc">$</span>LATITUDE)</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>  longitude <span class="ot">=</span> <span class="fu">append</span>(longitude, <span class="fu">content</span>(res)<span class="sc">$</span>results[[<span class="dv">1</span>]]<span class="sc">$</span>LONGITUDE)</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>rp_3rooms<span class="sc">$</span>full_address <span class="ot">=</span> full_address</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>rp_3rooms<span class="sc">$</span>lat <span class="ot">=</span> latitude</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>rp_3rooms<span class="sc">$</span>lon <span class="ot">=</span> longitude</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Before exporting the data frame to a csv file (to avoid repeating this lengthy step), we shall use the apply function to transform our three newly created columns to the right type (character / numerical type).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">digits=</span><span class="dv">15</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>rp_3rooms<span class="sc">$</span>full_address <span class="ot">=</span> <span class="fu">apply</span>(rp_3rooms[, <span class="dv">28</span>], <span class="dv">2</span>, as.character)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>rp_3rooms<span class="sc">$</span>lat <span class="ot">=</span> <span class="fu">apply</span>(rp_3rooms[, <span class="dv">29</span>], <span class="dv">2</span>, as.numeric)</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>rp_3rooms<span class="sc">$</span>lon <span class="ot">=</span> <span class="fu">apply</span>(rp_3rooms[, <span class="dv">30</span>], <span class="dv">2</span>, as.numeric)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(rp_3rooms, <span class="st">"data/aspatial/geocoded_resale_price.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We import the geocoded data back into the R environment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>rp_3rooms <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"data/aspatial/geocoded_resale_price.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="dropping-the-irrelevant-variables" class="level3" data-number="3.1.6">
<h3 data-number="3.1.6" class="anchored" data-anchor-id="dropping-the-irrelevant-variables"><span class="header-section-number">3.1.6</span> Dropping the irrelevant variables</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(rp_3rooms)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 38
  month   flat_t…¹ block stree…² store…³ floor…⁴ flat_…⁵ lease…⁶ remai…⁷ resal…⁸
  &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1 2021-01 3 ROOM   331   ANG MO… 04 TO …      68 New Ge…    1981    59    260000
2 2021-01 3 ROOM   534   ANG MO… 04 TO …      68 New Ge…    1980    58.2  265000
3 2021-01 3 ROOM   561   ANG MO… 01 TO …      68 New Ge…    1980    58.1  265000
4 2021-01 3 ROOM   170   ANG MO… 07 TO …      60 Improv…    1986    64.2  268000
5 2021-01 3 ROOM   463   ANG MO… 04 TO …      68 New Ge…    1980    58.2  268000
6 2021-01 3 ROOM   542   ANG MO… 04 TO …      68 New Ge…    1981    59.1  270000
# … with 28 more variables: `04 TO 06` &lt;dbl&gt;, `01 TO 03` &lt;dbl&gt;,
#   `07 TO 09` &lt;dbl&gt;, `10 TO 12` &lt;dbl&gt;, `13 TO 15` &lt;dbl&gt;, `16 TO 18` &lt;dbl&gt;,
#   `19 TO 21` &lt;dbl&gt;, `25 TO 27` &lt;dbl&gt;, `22 TO 24` &lt;dbl&gt;, `37 TO 39` &lt;dbl&gt;,
#   `31 TO 33` &lt;dbl&gt;, `34 TO 36` &lt;dbl&gt;, `40 TO 42` &lt;dbl&gt;, `46 TO 48` &lt;dbl&gt;,
#   `28 TO 30` &lt;dbl&gt;, `43 TO 45` &lt;dbl&gt;, cleaned_address &lt;chr&gt;,
#   full_address &lt;chr&gt;, lat &lt;dbl&gt;, lon &lt;dbl&gt;, `New Generation` &lt;dbl&gt;,
#   Improved &lt;dbl&gt;, `Model A` &lt;dbl&gt;, Simplified &lt;dbl&gt;, Standard &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>We will drop the following irrelevant fields.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>rp_3rooms.cleaned <span class="ot">=</span> rp_3rooms <span class="sc">%&gt;%</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"flat_type"</span>, <span class="st">"block"</span>, <span class="st">"street_name"</span>, <span class="st">"storey_range"</span>, <span class="st">"flat_model"</span>, <span class="st">"cleaned_address"</span>, <span class="st">"full_address"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="creating-the-sf-geometry" class="level3" data-number="3.1.7">
<h3 data-number="3.1.7" class="anchored" data-anchor-id="creating-the-sf-geometry"><span class="header-section-number">3.1.7</span> Creating the sf geometry</h3>
<p>Using the tibble data frame and lon/lat fields, we create a sf data frame and visualize the data with the tmap package.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">Creating the sf data frame</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">Visualizing the data</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>rp_3rooms.sf <span class="ot">=</span> <span class="fu">st_as_sf</span>(rp_3rooms.cleaned,</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>),</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz.sf)<span class="sc">+</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>()<span class="sc">+</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(rp_3rooms.sf)<span class="sc">+</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="primary-school-data" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="primary-school-data"><span class="header-section-number">3.2</span> Primary School data</h2>
<p>After thoroughly looking on the web, I was not able to find a list of primary schools of Singapore to download. So, to improve the reproducibility of my work, I scrapped the <a href="https://sgschooling.com/school/">sgschooling</a> website to retrieve what seemed to me like an up-to-date list of primary schools.</p>
<section id="scrapping-primary-schools-online-with-rvest-package" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="scrapping-primary-schools-online-with-rvest-package"><span class="header-section-number">3.2.1</span> Scrapping Primary Schools online with <em>rvest</em> package</h3>
<p>The first step is to retrieve the names of the primary schools. Looking at the code chunk below, I used the <em>httr</em>, <em>xml2</em>, and <em>rvest</em> packages to create a GET request, read the HTML code of the website, and extract the names of the schools to store them into a list.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">=</span> <span class="st">"https://sgschooling.com/school/"</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>res <span class="ot">=</span> <span class="fu">GET</span>(url)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>wiki_read <span class="ot">&lt;-</span> xml2<span class="sc">::</span><span class="fu">read_html</span>(res, <span class="at">encoding =</span> <span class="st">"UTF-8"</span>)</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>testt <span class="ot">=</span> wiki_read <span class="sc">%&gt;%</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"a"</span>)</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>testt1 <span class="ot">=</span> testt[<span class="fu">grepl</span>(<span class="st">"school/"</span>, testt)]</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>pattern <span class="ot">&lt;-</span> <span class="st">"&gt;(.*)&lt;"</span></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">regmatches</span>(testt1, <span class="fu">regexec</span>(pattern, testt1))</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>schools <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(result)){</span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>  new_row <span class="ot">=</span> result[[i]][<span class="dv">2</span>]</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>  schools <span class="ot">=</span> <span class="fu">append</span>(schools, new_row)</span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="using-the-onemap-api-to-retrieve-the-schools-coordinates" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="using-the-onemap-api-to-retrieve-the-schools-coordinates"><span class="header-section-number">3.2.2</span> Using the OneMap API to retrieve the schools’ coordinates</h3>
<p>I then used this list and the One Map API to geocode these schools and retrieve their address as well as their longitude and latitude, and then stored all of it into a data frame.</p>
<p>Note that in my code I include an if/else statement in the case where we do not get a perfect match and are not able to retrieve information with the API.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>primary_sc <span class="ot">=</span> <span class="fu">data.frame</span>()</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>url <span class="ot">=</span> <span class="st">"https://developers.onemap.sg/commonapi/search"</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(schools)){</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>  query <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"searchVal"</span> <span class="ot">=</span> schools[[i]],</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">"returnGeom"</span> <span class="ot">=</span> <span class="st">"Y"</span>, </span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>                <span class="st">"getAddrDetails"</span> <span class="ot">=</span> <span class="st">"Y"</span>)</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">GET</span>(url, <span class="at">query =</span> query)</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(<span class="fu">content</span>(result)<span class="sc">$</span>results) <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>    new_row <span class="ot">=</span> <span class="fu">c</span>(schools[[i]], </span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>              <span class="cn">NA</span>,</span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>              <span class="cn">NA</span>,</span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>              <span class="cn">NA</span>)</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>    primary_sc <span class="ot">=</span> <span class="fu">rbind</span>(primary_sc, new_row)</span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>    new_row <span class="ot">=</span> <span class="fu">c</span>(schools[[i]], </span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>                <span class="fu">content</span>(result)<span class="sc">$</span>results[[<span class="dv">1</span>]]<span class="sc">$</span>ADDRESS,</span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>                <span class="fu">content</span>(result)<span class="sc">$</span>results[[<span class="dv">1</span>]]<span class="sc">$</span>LATITUDE,</span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a>                <span class="fu">content</span>(result)<span class="sc">$</span>results[[<span class="dv">1</span>]]<span class="sc">$</span>LONGITUDE)</span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a>    primary_sc <span class="ot">=</span> <span class="fu">rbind</span>(primary_sc, new_row)</span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(primary_sc) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"location_name"</span>, <span class="st">"full_address"</span>, <span class="st">"lat"</span>, <span class="st">"lon"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="checking-for-missing-information" class="level3" data-number="3.2.3">
<h3 data-number="3.2.3" class="anchored" data-anchor-id="checking-for-missing-information"><span class="header-section-number">3.2.3</span> Checking for missing information</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(primary_sc<span class="sc">$</span>full_address))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It seems like we have missing data for 9 primary schools. It is probably because the name of the school is not recognized by the API, so we will try to clean them to get their information into our data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>primary_sc <span class="sc">%&gt;%</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(primary_sc<span class="sc">$</span>full_address) <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>By checking on the web, it seems like the “Juying Primary School” has merged with the “Pioneer Primary School”, so we may drop the “Juying Primary School” from the data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>primary_sc1 <span class="ot">=</span> primary_sc <span class="sc">%&gt;%</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"Juying Primary School"</span>, location_name))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, regarding the remaining schools, after performing a tests, it seems like I am not able to retrieve the information using the API so we will be filling the values with, first, the Google Maps API and then, if there are still some empty information, I will be filling the values manually by looking online.</p>
<p>You may want to check the next two code chunks I have used to try and retrieve the missing information using the OneMap API.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>primary_sc1<span class="sc">$</span>location_name <span class="ot">=</span> <span class="fu">str_replace</span>(primary_sc1<span class="sc">$</span>location_name, </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"St. "</span>, <span class="st">""</span>)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="co"># I have also tried replacing the string with: "Saint" and "St" but I am not able to make the API retrieve the data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">=</span> <span class="st">"https://developers.onemap.sg/commonapi/search"</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(primary_sc1)){</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(primary_sc1[i, <span class="dv">2</span>])){</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>    query <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"searchVal"</span> <span class="ot">=</span> primary_sc1[i, <span class="dv">1</span>],</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"returnGeom"</span> <span class="ot">=</span> <span class="st">"Y"</span>, </span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"getAddrDetails"</span> <span class="ot">=</span> <span class="st">"Y"</span>)</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="fu">GET</span>(url, <span class="at">query =</span> query)</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(<span class="fu">content</span>(result)<span class="sc">$</span>results) <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span>{</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>        primary_sc1[i, <span class="dv">2</span>] <span class="ot">=</span> <span class="fu">content</span>(result)<span class="sc">$</span>results[[<span class="dv">1</span>]]<span class="sc">$</span>ADDRESS</span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>        primary_sc1[i, <span class="dv">3</span>] <span class="ot">=</span> <span class="fu">content</span>(result)<span class="sc">$</span>results[[<span class="dv">1</span>]]<span class="sc">$</span>LATITUDE</span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>        primary_sc1[i, <span class="dv">4</span>] <span class="ot">=</span> <span class="fu">content</span>(result)<span class="sc">$</span>results[[<span class="dv">1</span>]]<span class="sc">$</span>LONGITUDE</span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a>  }} <span class="cf">else</span>{ <span class="cf">next</span></span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These are the schools with the missing information.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>primary_sc1 <span class="sc">%&gt;%</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(primary_sc1<span class="sc">$</span>full_address) <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using the Google Maps API and its library <em>ggmap</em>, we will loop through the schools with missing coordinates. Since all these schools are located consecutively in the data frame, I use the following structure to create the list of schools.</p>
<p>While looping through these schools, we use the geocode() function of <em>ggmap</em> to retrieve the latitude and longitude based on the school name and assign these values in the corresponding missing cells of the primary_sc1 data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">register_google</span>(<span class="at">key =</span> <span class="st">"xxx"</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>missing_sc <span class="ot">=</span> primary_sc1[<span class="fu">grep</span>(<span class="st">"St. Andrew’s Junior School"</span>, primary_sc1<span class="sc">$</span>location_name)<span class="sc">:</span><span class="fu">grep</span>(<span class="st">"St. Stephen’s School"</span>, primary_sc1<span class="sc">$</span>location_name), <span class="dv">1</span>]</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> missing_sc){</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>  coords <span class="ot">=</span> <span class="fu">geocode</span>(i)</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>  primary_sc1[<span class="fu">grep</span>(i, primary_sc1<span class="sc">$</span>location_name), <span class="dv">3</span>] <span class="ot">=</span> coords<span class="sc">$</span>lat</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>  primary_sc1[<span class="fu">grep</span>(i, primary_sc1<span class="sc">$</span>location_name), <span class="dv">4</span>] <span class="ot">=</span> coords<span class="sc">$</span>lon</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We should check if we still have missing coordinates. Note that we are missing information in the full_address column, however, it is not a great deal since we will be using the coordinates to create the sf objects later on.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>primary_sc1 <span class="sc">%&gt;%</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(primary_sc1<span class="sc">$</span>lat) <span class="sc">==</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We are still missing coordinates for three schools. We will be filling these values manually.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>primary_sc1[<span class="fu">grep</span>(<span class="st">"St. Anthony’s Primary School"</span>, primary_sc1<span class="sc">$</span>location_name), <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>] <span class="ot">=</span> <span class="fu">list</span>(<span class="fl">1.3796337949311097</span>, <span class="fl">103.75033229288428</span>)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>primary_sc1[<span class="fu">grep</span>(<span class="st">"St. Gabriel’s Primary School"</span>, primary_sc1<span class="sc">$</span>location_name), <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>] <span class="ot">=</span> <span class="fu">list</span>(<span class="fl">1.3499742816603595</span>, <span class="fl">103.86268328706147</span>)</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>primary_sc1[<span class="fu">grep</span>(<span class="st">"St. Stephen’s School"</span>, primary_sc1<span class="sc">$</span>location_name), <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>] <span class="ot">=</span> <span class="fu">list</span>(<span class="fl">1.3189794629543288</span>, <span class="fl">103.9179118196036</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We are now good to go, we can proceed to creating a sf data frame, however, before doing so, I will export the data frame into my data folder to avoid using the Google Maps API again (it is free under a limited amount of queries).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(primary_sc1, <span class="st">"data/aspatial/primary_schools.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>primary_schools <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"data/aspatial/primary_schools.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="creating-the-sf-data-frame-1" class="level3" data-number="3.2.4">
<h3 data-number="3.2.4" class="anchored" data-anchor-id="creating-the-sf-data-frame-1"><span class="header-section-number">3.2.4</span> Creating the sf data frame</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>primary_schools.sf <span class="ot">=</span> <span class="fu">st_as_sf</span>(primary_schools,</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>),</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="visualizing-the-data-5" class="level3" data-number="3.2.5">
<h3 data-number="3.2.5" class="anchored" data-anchor-id="visualizing-the-data-5"><span class="header-section-number">3.2.5</span> Visualizing the data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz.sf)<span class="sc">+</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>()<span class="sc">+</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(primary_schools.sf)<span class="sc">+</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="creating-a-field-with-the-top-20-primary-schools" class="level3" data-number="3.2.6">
<h3 data-number="3.2.6" class="anchored" data-anchor-id="creating-a-field-with-the-top-20-primary-schools"><span class="header-section-number">3.2.6</span> Creating a field with the Top 20 Primary Schools</h3>
<p>We will now create an additional variable that indicates whether one primary school is considered good or not. I made the selection factor be whether the primary school is in the Top 20 primary schools or not. I extracted from the internet the Top 20 list that you may find below. With this list, we can create a dummy variable that stores a 1 (0) if the school is part (or not) of the Top 20.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>top20_sc <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Methodist Girls’ School (Primary)"</span>, <span class="st">"Catholic High School"</span>, <span class="st">"Tao Nan School"</span>, <span class="st">"Pei Hwa Presbyterian Primary School"</span>, <span class="st">"Holy Innocents’ Primary School"</span>, <span class="st">"Nan Hua Primary School"</span>, <span class="st">"CHIJ St. Nicholas Girls’ School"</span>, <span class="st">"Admiralty Primary School"</span>, <span class="st">"St. Hilda’s Primary School"</span>, <span class="st">"Ai Tong School"</span>, <span class="st">"Anglo-Chinese School (Junior)"</span>, <span class="st">"Chongfu School"</span>, <span class="st">"St. Joseph’s Institution Junior"</span>, <span class="st">"Anglo-Chinese School (Primary)"</span>, <span class="st">"Singapore Chinese Girls’ Primary School"</span>, <span class="st">"Nanyang Primary School"</span>, <span class="st">"South View Primary School"</span>, <span class="st">"Pei Chun Public School"</span>, <span class="st">"Kong Hwa School"</span>, <span class="st">"Rosyth School"</span>)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>primary_schools.sf[<span class="st">"top20"</span>] <span class="ot">=</span> <span class="fu">ifelse</span>(primary_schools.sf<span class="sc">$</span>location_name <span class="sc">%in%</span> top20_sc <span class="sc">==</span> <span class="cn">TRUE</span>,</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="dv">1</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that I originally forgot to create this variable and am doing it after having ran all the regressions. Unfortunately, since my computer crashes most of the time when trying to perform the geographic regression, I won’t be able to include it now, but I still made sure to include how to create this variable.</p>
</section>
</section>
<section id="shopping-mall-data" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="shopping-mall-data"><span class="header-section-number">3.3</span> Shopping Mall data</h2>
<p>We encounter the same problem with the shopping malls as when looking for a data set of primary schools, so I decided to scrape Wikipedia for this one.</p>
<p>We perform very similar steps as the previous section on primary schools, so I won’t run you through every step.</p>
<section id="scraping-wikipedia-to-extract-the-list-of-malls-in-singapore" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="scraping-wikipedia-to-extract-the-list-of-malls-in-singapore"><span class="header-section-number">3.3.1</span> Scraping Wikipedia to extract the list of malls in Singapore</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">=</span> <span class="st">"https://en.wikipedia.org/wiki/List_of_shopping_malls_in_Singapore"</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>res <span class="ot">=</span> <span class="fu">GET</span>(url)</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>wiki_read <span class="ot">&lt;-</span> xml2<span class="sc">::</span><span class="fu">read_html</span>(res, <span class="at">encoding =</span> <span class="st">"UTF-8"</span>)</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>testt <span class="ot">=</span> wiki_read <span class="sc">%&gt;%</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">"div.div-col"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"ul"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"li"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>()</span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>malls <span class="ot">=</span> <span class="fu">str_replace</span>(testt, <span class="st">"</span><span class="sc">\\</span><span class="st">[.*]"</span>, <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="using-the-onemap-api-to-retrieve-the-malls-coordinates" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="using-the-onemap-api-to-retrieve-the-malls-coordinates"><span class="header-section-number">3.3.2</span> Using the OneMap API to retrieve the malls’ coordinates</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>shp_malls <span class="ot">=</span> <span class="fu">data.frame</span>()</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>url <span class="ot">=</span> <span class="st">"https://developers.onemap.sg/commonapi/search"</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(malls)){</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>  query <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"searchVal"</span> <span class="ot">=</span> malls[i],</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">"returnGeom"</span> <span class="ot">=</span> <span class="st">"Y"</span>, </span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>                <span class="st">"getAddrDetails"</span> <span class="ot">=</span> <span class="st">"Y"</span>)</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">GET</span>(url, <span class="at">query =</span> query)</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(<span class="fu">content</span>(result)<span class="sc">$</span>results) <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>    new_row <span class="ot">=</span> <span class="fu">c</span>(malls[i], </span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>              <span class="cn">NA</span>,</span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>              <span class="cn">NA</span>,</span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>              <span class="cn">NA</span>)</span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>    shp_malls <span class="ot">=</span> <span class="fu">rbind</span>(shp_malls, new_row)</span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>    new_row <span class="ot">=</span> <span class="fu">c</span>(malls[i], </span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a>                <span class="fu">content</span>(result)<span class="sc">$</span>results[[<span class="dv">1</span>]]<span class="sc">$</span>ADDRESS,</span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a>                <span class="fu">content</span>(result)<span class="sc">$</span>results[[<span class="dv">1</span>]]<span class="sc">$</span>LATITUDE,</span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a>                <span class="fu">content</span>(result)<span class="sc">$</span>results[[<span class="dv">1</span>]]<span class="sc">$</span>LONGITUDE)</span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a>    shp_malls <span class="ot">=</span> <span class="fu">rbind</span>(shp_malls, new_row)</span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb86-30"><a href="#cb86-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-31"><a href="#cb86-31" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(shp_malls) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"location_name"</span>, <span class="st">"full_address"</span>, <span class="st">"lat"</span>, <span class="st">"lon"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(shp_malls<span class="sc">$</span>full_address))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="filling-missing-information-with-ggmap" class="level3" data-number="3.3.3">
<h3 data-number="3.3.3" class="anchored" data-anchor-id="filling-missing-information-with-ggmap"><span class="header-section-number">3.3.3</span> Filling missing information with ggmap</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>shp_malls <span class="sc">%&gt;%</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(shp_malls<span class="sc">$</span>full_address) <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Before using the Google Maps API, I decided to research about these nine malls and found that:</p>
<ul>
<li><p>The PoMo mall is now called GR.iD, so we shall change the name in the data frame</p></li>
<li><p>The KINEX mall is found under the name KINEX, so we shall remove the additional information from the name</p></li>
<li><p>The Paya Lebar Quarter mall is found under the name PLQ mall on Google Maps, so we shall change the name in the data frame</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>shp_malls[<span class="fu">grep</span>(<span class="st">"PoMo"</span>, shp_malls<span class="sc">$</span>location_name), <span class="dv">1</span>] <span class="ot">=</span> <span class="st">"GR.iD"</span>;</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>shp_malls[<span class="fu">grep</span>(<span class="st">"KINEX"</span>, shp_malls<span class="sc">$</span>location_name), <span class="dv">1</span>] <span class="ot">=</span> <span class="st">"KINEX"</span>;</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>shp_malls[<span class="fu">grep</span>(<span class="st">"PLQ"</span>, shp_malls<span class="sc">$</span>location_name), <span class="dv">1</span>] <span class="ot">=</span> <span class="st">"PLQ mall"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">register_google</span>(<span class="at">key =</span> <span class="st">"xxx"</span>)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>missing_malls <span class="ot">=</span> shp_malls <span class="sc">%&gt;%</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(shp_malls<span class="sc">$</span>full_address) <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">$</span><span class="st">`</span>(location_name)</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">list</span>(missing_malls)[[<span class="dv">1</span>]]){</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>  coords <span class="ot">=</span> <span class="fu">geocode</span>(i)</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>  shp_malls[<span class="fu">grep</span>(i, shp_malls<span class="sc">$</span>location_name), <span class="dv">3</span>] <span class="ot">=</span> coords<span class="sc">$</span>lat</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>  shp_malls[<span class="fu">grep</span>(i, shp_malls<span class="sc">$</span>location_name), <span class="dv">4</span>] <span class="ot">=</span> coords<span class="sc">$</span>lon</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>shp_malls <span class="sc">%&gt;%</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(shp_malls<span class="sc">$</span>lat) <span class="sc">==</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="filling-missing-information-manually" class="level3" data-number="3.3.4">
<h3 data-number="3.3.4" class="anchored" data-anchor-id="filling-missing-information-manually"><span class="header-section-number">3.3.4</span> Filling missing information manually</h3>
<p>We are still missing coordinates of the KINEX mall. We will be filling these values manually.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>shp_malls[<span class="fu">grep</span>(<span class="st">"KINEX"</span>, shp_malls<span class="sc">$</span>location_name), <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>] <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">1.314893715213727</span>, <span class="fl">103.89480904154526</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We are now good to go, we can proceed to creating a sf data frame, however, before doing so, I will export the data frame into my data folder to avoid using the Google Maps API again (it is free under a limited amount of queries).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(shp_malls, <span class="st">"data/aspatial/shopping_malls.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>shp_malls <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"data/aspatial/shopping_malls.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="creating-an-sf-data-frame" class="level3" data-number="3.3.5">
<h3 data-number="3.3.5" class="anchored" data-anchor-id="creating-an-sf-data-frame"><span class="header-section-number">3.3.5</span> Creating an sf data frame</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>shp_malls.sf <span class="ot">=</span> <span class="fu">st_as_sf</span>(shp_malls,</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>),</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="visualizing-the-data-6" class="level3" data-number="3.3.6">
<h3 data-number="3.3.6" class="anchored" data-anchor-id="visualizing-the-data-6"><span class="header-section-number">3.3.6</span> Visualizing the data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz.sf)<span class="sc">+</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>()<span class="sc">+</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(shp_malls.sf)<span class="sc">+</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-81-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="preparing-the-final-data-frame" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Preparing the final data frame</h1>
<p>In this section, we will prepare the following variables:</p>
<p>Proximity to CBD ; Proximity to eldercare ; Proximity to foodcourt/hawker centres ; Proximity to MRT ; Proximity to park ; Proximity to good primary school ; Proximity to shopping mall ; Proximity to supermarket</p>
<p>Numbers of kindergartens within 350m ; Numbers of childcare centres within 350m ; Numbers of bus stop within 350m ; Numbers of primary school within 1km</p>
<section id="proximity-variables" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="proximity-variables"><span class="header-section-number">4.1</span> Proximity variables</h2>
<section id="proximity-to-cbd" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="proximity-to-cbd"><span class="header-section-number">4.1.1</span> Proximity to CBD</h3>
<p>We will consider the Downtown Core planning area to be the Central Business District. Given the previous statement, we will compute the distance of each HDB flats to the CBD area.</p>
<p>The first step is to compute the nearest feature between the HDB flats and CDB area. With this, we then can create a column that stores the distance between the two features (e.g., distance between each flat and nearest part of the CBD).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>cbd_zone.sf <span class="ot">=</span> mpsz.sf <span class="sc">%&gt;%</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PLN_AREA_N <span class="sc">==</span> <span class="st">"DOWNTOWN CORE"</span>)</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>nearest <span class="ot">=</span> <span class="fu">st_nearest_feature</span>(rp_3rooms.sf, cbd_zone.sf)</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>rp_3rooms.sf<span class="sc">$</span>distance_to_cdb <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_distance</span>(rp_3rooms.sf, </span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>              cbd_zone.sf[nearest,],</span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">by_element=</span><span class="cn">TRUE</span>) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that I had forgot to compute this variable when running my regressions, so you won’t see it later but I made sure to include the code to compute it.</p>
</section>
<section id="proximity-to-eldercare" class="level3" data-number="4.1.2">
<h3 data-number="4.1.2" class="anchored" data-anchor-id="proximity-to-eldercare"><span class="header-section-number">4.1.2</span> Proximity to eldercare</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>eldercare.sf <span class="ot">=</span> retrieved_variables.sf <span class="sc">%&gt;%</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(variable_name <span class="sc">==</span> <span class="st">"eldercare"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>nearest <span class="ot">=</span> <span class="fu">st_nearest_feature</span>(rp_3rooms.sf, eldercare.sf)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>rp_3rooms.sf<span class="sc">$</span>distance_to_eldercare <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_distance</span>(rp_3rooms.sf, </span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>              eldercare.sf[nearest,],</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">by_element=</span><span class="cn">TRUE</span>) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="proximity-to-food-court-hawker-centres" class="level3" data-number="4.1.3">
<h3 data-number="4.1.3" class="anchored" data-anchor-id="proximity-to-food-court-hawker-centres"><span class="header-section-number">4.1.3</span> Proximity to food court / hawker centres</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>hawker_centres.sf <span class="ot">=</span> retrieved_variables.sf <span class="sc">%&gt;%</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(variable_name <span class="sc">==</span> <span class="st">"hawker_centres"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>nearest <span class="ot">=</span> <span class="fu">st_nearest_feature</span>(rp_3rooms.sf, hawker_centres.sf)</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>rp_3rooms.sf<span class="sc">$</span>distance_to_food <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_distance</span>(rp_3rooms.sf, </span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>              hawker_centres.sf[nearest,], </span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">by_element=</span><span class="cn">TRUE</span>) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="proximity-to-mrt" class="level3" data-number="4.1.4">
<h3 data-number="4.1.4" class="anchored" data-anchor-id="proximity-to-mrt"><span class="header-section-number">4.1.4</span> Proximity to MRT</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>nearest <span class="ot">=</span> <span class="fu">st_nearest_feature</span>(rp_3rooms.sf, mrt_exits.sf)</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>rp_3rooms.sf<span class="sc">$</span>distance_to_mrt <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_distance</span>(rp_3rooms.sf, </span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>              mrt_exits.sf[nearest,],</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">by_element=</span><span class="cn">TRUE</span>) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="proximity-to-park" class="level3" data-number="4.1.5">
<h3 data-number="4.1.5" class="anchored" data-anchor-id="proximity-to-park"><span class="header-section-number">4.1.5</span> Proximity to park</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>parks.sf <span class="ot">=</span> retrieved_variables.sf <span class="sc">%&gt;%</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(variable_name <span class="sc">==</span> <span class="st">"parks"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>nearest <span class="ot">=</span> <span class="fu">st_nearest_feature</span>(rp_3rooms.sf, parks.sf)</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>rp_3rooms.sf<span class="sc">$</span>distance_to_park <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_distance</span>(rp_3rooms.sf, </span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>              parks.sf[nearest,],</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">by_element=</span><span class="cn">TRUE</span>) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="proximity-to-good-primary-school" class="level3" data-number="4.1.6">
<h3 data-number="4.1.6" class="anchored" data-anchor-id="proximity-to-good-primary-school"><span class="header-section-number">4.1.6</span> Proximity to good primary school</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>nearest <span class="ot">=</span> <span class="fu">st_nearest_feature</span>(rp_3rooms.sf, primary_schools.sf)</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>rp_3rooms.sf<span class="sc">$</span>top20_schools <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_distance</span>(rp_3rooms.sf, </span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>              primary_schools.sf[nearest,],</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">by_element=</span><span class="cn">TRUE</span>) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="proximity-to-shopping-mall" class="level3" data-number="4.1.7">
<h3 data-number="4.1.7" class="anchored" data-anchor-id="proximity-to-shopping-mall"><span class="header-section-number">4.1.7</span> Proximity to shopping mall</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>nearest <span class="ot">=</span> <span class="fu">st_nearest_feature</span>(rp_3rooms.sf, shp_malls.sf)</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>rp_3rooms.sf<span class="sc">$</span>distance_to_mall <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_distance</span>(rp_3rooms.sf, </span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>              shp_malls.sf[nearest,], </span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">by_element=</span><span class="cn">TRUE</span>) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="proximity-to-supermarket" class="level3" data-number="4.1.8">
<h3 data-number="4.1.8" class="anchored" data-anchor-id="proximity-to-supermarket"><span class="header-section-number">4.1.8</span> Proximity to supermarket</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>nearest <span class="ot">=</span> <span class="fu">st_nearest_feature</span>(rp_3rooms.sf, supermarkets.sf)</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>rp_3rooms.sf<span class="sc">$</span>distance_to_supermarkets <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_distance</span>(rp_3rooms.sf, </span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>              supermarkets.sf[nearest,], </span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">by_element=</span><span class="cn">TRUE</span>) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="number-of-within-given-distance" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="number-of-within-given-distance"><span class="header-section-number">4.2</span> Number of … within given distance</h2>
<p>The first step is to create buffers for each HDB flat. We create two buffers, one of 350m and one of 1000m (1km).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>buffer_350  <span class="ot">=</span> <span class="fu">st_buffer</span>(rp_3rooms.sf, <span class="dv">350</span>)</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>buffer_1000 <span class="ot">=</span> <span class="fu">st_buffer</span>(rp_3rooms.sf, <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using these buffers will allow us to compute the number of a given variable inside the buffer.</p>
<section id="numbers-of-kindergartens-within-350m" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="numbers-of-kindergartens-within-350m"><span class="header-section-number">4.2.1</span> Numbers of kindergartens within 350m</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>kindergartens.sf <span class="ot">=</span> retrieved_variables.sf <span class="sc">%&gt;%</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(variable_name <span class="sc">==</span> <span class="st">"kindergartens"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>rp_3rooms.sf<span class="sc">$</span>nb_of_kindergartens <span class="ot">=</span> <span class="fu">lengths</span>(</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_intersects</span>(buffer_350, kindergartens.sf))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="numbers-of-childcare-centres-within-350m" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="numbers-of-childcare-centres-within-350m"><span class="header-section-number">4.2.2</span> Numbers of childcare centres within 350m</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>child_care.sf <span class="ot">=</span> retrieved_variables.sf <span class="sc">%&gt;%</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(variable_name <span class="sc">==</span> <span class="st">"child_care"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>rp_3rooms.sf<span class="sc">$</span>nb_of_childcare <span class="ot">=</span> <span class="fu">lengths</span>(</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_intersects</span>(buffer_350, child_care.sf))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="numbers-of-bus-stop-within-350m" class="level3" data-number="4.2.3">
<h3 data-number="4.2.3" class="anchored" data-anchor-id="numbers-of-bus-stop-within-350m"><span class="header-section-number">4.2.3</span> Numbers of bus stop within 350m</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>rp_3rooms.sf<span class="sc">$</span>nb_of_bus_stops <span class="ot">=</span> <span class="fu">lengths</span>(</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_intersects</span>(buffer_350, bus_stops.sf))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="numbers-of-primary-school-within-1km" class="level3" data-number="4.2.4">
<h3 data-number="4.2.4" class="anchored" data-anchor-id="numbers-of-primary-school-within-1km"><span class="header-section-number">4.2.4</span> Numbers of primary school within 1km</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>rp_3rooms.sf<span class="sc">$</span>nb_of_primary_schools <span class="ot">=</span> <span class="fu">lengths</span>(</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_intersects</span>(buffer_1000, primary_schools.sf))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="saving-the-data" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="saving-the-data"><span class="header-section-number">4.3</span> Saving the data</h2>
<p>We will save the data into a rds file to avoid running all the previous code every time we would like to work on the assignment since some of these steps are very lengthy.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(rp_3rooms.sf, <span class="st">"data/geospatial/final_dataset.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>rp_3rooms.sf <span class="ot">=</span> <span class="fu">read_rds</span>(<span class="st">"data/geospatial/final_dataset.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="check-for-missing-data" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="check-for-missing-data"><span class="header-section-number">4.4</span> Check for missing data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(rp_3rooms.sf))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p>There is no missing that so we can move on to creating the hedonistic pricing models.</p>
</section>
</section>
<section id="hedonic-pricing-model" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Hedonic Pricing model</h1>
<p>The first step to our hedonistic pricing model is to clean the name of our fields. We do so using the rename function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>rp_3rooms.sf <span class="ot">=</span> rp_3rooms.sf <span class="sc">%&gt;%</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"01_to_03"</span> <span class="ot">=</span> <span class="st">"01 TO 03"</span>, <span class="st">"04_to_06"</span> <span class="ot">=</span> <span class="st">"04 TO 06"</span>, <span class="st">"07_to_09"</span> <span class="ot">=</span> <span class="st">"07 TO 09"</span>,</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>         <span class="st">"10_to_12"</span> <span class="ot">=</span> <span class="st">"10 TO 12"</span>, <span class="st">"13_to_15"</span> <span class="ot">=</span> <span class="st">"13 TO 15"</span>, <span class="st">"16_to_18"</span> <span class="ot">=</span> <span class="st">"16 TO 18"</span>,</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>         <span class="st">"19_to_21"</span> <span class="ot">=</span> <span class="st">"19 TO 21"</span>, <span class="st">"22_to_24"</span> <span class="ot">=</span> <span class="st">"22 TO 24"</span>, <span class="st">"25_to_27"</span> <span class="ot">=</span> <span class="st">"25 TO 27"</span>,</span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">"28_to_30"</span> <span class="ot">=</span> <span class="st">"28 TO 30"</span>, <span class="st">"31_to_33"</span> <span class="ot">=</span> <span class="st">"31 TO 33"</span>, <span class="st">"34_to_36"</span> <span class="ot">=</span> <span class="st">"34 TO 36"</span>,</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>         <span class="st">"37_to_39"</span> <span class="ot">=</span> <span class="st">"37 TO 39"</span>, <span class="st">"40_to_42"</span> <span class="ot">=</span> <span class="st">"40 TO 42"</span>, <span class="st">"43_to_45"</span> <span class="ot">=</span> <span class="st">"43 TO 45"</span>,</span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>         <span class="st">"46_to_48"</span> <span class="ot">=</span> <span class="st">"46 TO 48"</span>, <span class="st">"New_Generation"</span> <span class="ot">=</span> <span class="st">"New Generation"</span>, </span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Model_A"</span> <span class="ot">=</span> <span class="st">"Model A"</span>, <span class="st">"Premium_Apartment"</span> <span class="ot">=</span> <span class="st">"Premium Apartment"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="splitting-the-data" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="splitting-the-data"><span class="header-section-number">5.1</span> Splitting the data</h2>
<p>Now that are fields are cleaned, we should split the data into two data frames. One data frame used for training and one for testing. We do so using the filter and grepl functions.</p>
<p>Note that you can use regular expressions to be more efficient when trying to string match.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>rp_analysis.sf <span class="ot">=</span> rp_3rooms.sf <span class="sc">%&gt;%</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"202[12]"</span>, month))</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>rp_testing.sf <span class="ot">=</span> rp_3rooms.sf <span class="sc">%&gt;%</span></span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"2023"</span>, month))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="conventional-ols-method" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Conventional OLS method</h1>
<p>The first analysis we will perform is the “standard” or “conventional” OLS. This is a multiple linear regression that takes into account only our independent variables. It does not use geographical location as a determinant of the resale price of an HDB flat.</p>
<p>Before running the analysis, there are a few preliminary steps. We should check for: non-linear relationships between the independent variables and the dependent variables; multicollinearity; heteroscedasticity.</p>
<section id="multicollinearity" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="multicollinearity"><span class="header-section-number">6.1</span> Multicollinearity</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>corrplot<span class="sc">::</span><span class="fu">corrplot</span>(<span class="fu">cor</span>(rp_3rooms.sf <span class="sc">%&gt;%</span> </span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">22</span>, <span class="dv">23</span>))), </span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">diag =</span> <span class="cn">FALSE</span>, <span class="at">order =</span> <span class="st">"AOE"</span>, <span class="at">tl.pos =</span> <span class="st">"td"</span>, </span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">tl.cex =</span> <span class="fl">0.5</span>, <span class="at">method =</span> <span class="st">"number"</span>, <span class="at">type =</span> <span class="st">"upper"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-105-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="mlr-model" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="mlr-model"><span class="header-section-number">6.2</span> MLR model</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(rp_3rooms.sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>rp_analysis.mlr <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> resale_price <span class="sc">~</span> floor_area_sqm <span class="sc">+</span> remaining_lease <span class="sc">+</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>                      <span class="st">`</span><span class="at">01_to_03</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">04_to_06</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">07_to_09</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">10_to_12</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">13_to_15</span><span class="st">`</span> <span class="sc">+</span> </span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>                      <span class="st">`</span><span class="at">16_to_18</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">19_to_21</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">22_to_24</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">25_to_27</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">28_to_30</span><span class="st">`</span> <span class="sc">+</span> </span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>                      <span class="st">`</span><span class="at">31_to_33</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">34_to_36</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">37_to_39</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">40_to_42</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">43_to_45</span><span class="st">`</span> <span class="sc">+</span> </span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>                      <span class="st">`</span><span class="at">New_Generation</span><span class="st">`</span> <span class="sc">+</span> Improved <span class="sc">+</span> <span class="st">`</span><span class="at">Model_A</span><span class="st">`</span> <span class="sc">+</span> Simplified <span class="sc">+</span> Standard <span class="sc">+</span> </span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>                      <span class="st">`</span><span class="at">Premium_Apartment</span><span class="st">`</span> <span class="sc">+</span> DBSS <span class="sc">+</span> distance_to_eldercare <span class="sc">+</span> </span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>                      distance_to_food <span class="sc">+</span> distance_to_mrt <span class="sc">+</span> distance_to_park <span class="sc">+</span> </span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a>                      distance_to_mall <span class="sc">+</span> distance_to_supermarkets <span class="sc">+</span> nb_of_kindergartens <span class="sc">+</span></span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a>                      nb_of_childcare <span class="sc">+</span> nb_of_bus_stops <span class="sc">+</span> nb_of_primary_schools, </span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> rp_analysis.sf)</span>
<span id="cb123-11"><a href="#cb123-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-12"><a href="#cb123-12" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(rp_analysis.mlr, <span class="at">type=</span><span class="st">"text"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
====================================================
                             Dependent variable:    
                         ---------------------------
                                resale_price        
----------------------------------------------------
floor_area_sqm                  3,946.537***        
                                  (93.530)          
                                                    
remaining_lease                 2,754.191***        
                                  (61.207)          
                                                    
`01_to_03`                     -257,839.693***      
                                (52,620.249)        
                                                    
`04_to_06`                     -248,405.940***      
                                (52,616.441)        
                                                    
`07_to_09`                     -241,109.221***      
                                (52,616.860)        
                                                    
`10_to_12`                     -232,833.112***      
                                (52,618.266)        
                                                    
`13_to_15`                     -224,504.937***      
                                (52,626.152)        
                                                    
`16_to_18`                     -205,120.927***      
                                (52,659.851)        
                                                    
`19_to_21`                     -174,800.777***      
                                (52,757.140)        
                                                    
`22_to_24`                     -158,664.647***      
                                (52,852.098)        
                                                    
`25_to_27`                     -127,272.290**       
                                (52,922.790)        
                                                    
`28_to_30`                      -96,167.414*        
                                (53,084.925)        
                                                    
`31_to_33`                       -79,389.789        
                                (53,208.006)        
                                                    
`34_to_36`                       -58,544.715        
                                (53,510.236)        
                                                    
`37_to_39`                       -47,678.241        
                                (53,296.651)        
                                                    
`40_to_42`                       -28,303.576        
                                (56,745.135)        
                                                    
`43_to_45`                       27,962.420         
                                (58,710.939)        
                                                    
New_Generation                 -429,929.634***      
                                (10,800.164)        
                                                    
Improved                       -423,909.938***      
                                (11,010.310)        
                                                    
Model_A                        -422,627.638***      
                                (10,789.771)        
                                                    
Simplified                     -402,908.906***      
                                (11,227.145)        
                                                    
Standard                       -413,750.267***      
                                (11,376.659)        
                                                    
Premium_Apartment              -399,095.702***      
                                (11,179.217)        
                                                    
DBSS                           -348,968.293***      
                                (11,638.597)        
                                                    
distance_to_eldercare            -16.072***         
                                   (0.945)          
                                                    
distance_to_food                 -19.181***         
                                   (1.600)          
                                                    
distance_to_mrt                  -27.268***         
                                   (1.376)          
                                                    
distance_to_park                 -20.903***         
                                   (1.530)          
                                                    
distance_to_mall                 -11.363***         
                                   (1.352)          
                                                    
distance_to_supermarkets          -5.749**          
                                   (2.591)          
                                                    
nb_of_kindergartens             4,512.822***        
                                  (642.853)         
                                                    
nb_of_childcare                 -2,789.315***       
                                  (295.193)         
                                                    
nb_of_bus_stops                  -910.529***        
                                  (188.399)         
                                                    
nb_of_primary_schools           -7,938.305***       
                                  (369.917)         
                                                    
Constant                       675,321.297***       
                                (54,923.892)        
                                                    
----------------------------------------------------
Observations                       12,608           
R2                                  0.638           
Adjusted R2                         0.637           
Residual Std. Error        52,512.632 (df = 12573)  
F Statistic              652.049*** (df = 34; 12573)
====================================================
Note:                    *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</code></pre>
</div>
</div>
</section>
<section id="linearity" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="linearity"><span class="header-section-number">6.3</span> Linearity</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">residuals</span>(rp_analysis.mlr), <span class="fu">fitted.values</span>(rp_analysis.mlr),</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"Residuals"</span>, <span class="at">ylab=</span><span class="st">"Fitted Values"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-108-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="heteroscedasticity" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="heteroscedasticity"><span class="header-section-number">6.4</span> Heteroscedasticity</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gqtest</span>(rp_analysis.mlr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Goldfeld-Quandt test

data:  rp_analysis.mlr
GQ = 0.9281659246132, df1 = 6269, df2 = 6269, p-value = 0.99841450489
alternative hypothesis: variance increases from segment 1 to 2</code></pre>
</div>
</div>
</section>
</section>
<section id="gwr-methods" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> GWR methods</h1>
<section id="converting-sf-data-frame-to-spatialpointdataframe" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="converting-sf-data-frame-to-spatialpointdataframe"><span class="header-section-number">7.1</span> Converting sf data frame to SpatialPointDataFrame</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>rp_analysis.sp <span class="ot">=</span> <span class="fu">as_Spatial</span>(rp_analysis.sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="computing-adaptive-bandwidth" class="level3" data-number="7.1.1">
<h3 data-number="7.1.1" class="anchored" data-anchor-id="computing-adaptive-bandwidth"><span class="header-section-number">7.1.1</span> Computing adaptive bandwidth</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>bw_analysis_adaptive <span class="ot">&lt;-</span> <span class="fu">bw.gwr</span>(resale_price <span class="sc">~</span> floor_area_sqm <span class="sc">+</span> remaining_lease <span class="sc">+</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>                      X01_to_03 <span class="sc">+</span> X04_to_06 <span class="sc">+</span> X07_to_09 <span class="sc">+</span> X10_to_12 <span class="sc">+</span> X13_to_15 <span class="sc">+</span> </span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>                      X16_to_18 <span class="sc">+</span> X19_to_21 <span class="sc">+</span> X22_to_24 <span class="sc">+</span> X25_to_27 <span class="sc">+</span> X28_to_30 <span class="sc">+</span> </span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>                      X31_to_33 <span class="sc">+</span> X34_to_36 <span class="sc">+</span> X37_to_39 <span class="sc">+</span> X40_to_42 <span class="sc">+</span> X43_to_45 <span class="sc">+</span> </span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>                      New_Generation <span class="sc">+</span> Improved <span class="sc">+</span> Model_A <span class="sc">+</span> Simplified <span class="sc">+</span> Standard <span class="sc">+</span> </span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>                      Premium_Apartment <span class="sc">+</span> DBSS <span class="sc">+</span> distance_to_eldercare <span class="sc">+</span> </span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>                      distance_to_food <span class="sc">+</span> distance_to_mrt <span class="sc">+</span> distance_to_park <span class="sc">+</span> </span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a>                      distance_to_mall <span class="sc">+</span> distance_to_supermarkets <span class="sc">+</span> nb_of_kindergartens <span class="sc">+</span></span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a>                      nb_of_childcare <span class="sc">+</span> nb_of_bus_stops <span class="sc">+</span> nb_of_primary_schools, </span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> rp_analysis.sp, <span class="at">approach=</span><span class="st">"CV"</span>, <span class="at">kernel=</span><span class="st">"gaussian"</span>,</span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">adaptive=</span><span class="cn">TRUE</span>, <span class="at">longlat=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(bw_analysis_adaptive, <span class="st">"data/model/bw_analysis_adaptive.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="constructing-the-adaptive-bandwidth-gwr-model" class="level3" data-number="7.1.2">
<h3 data-number="7.1.2" class="anchored" data-anchor-id="constructing-the-adaptive-bandwidth-gwr-model"><span class="header-section-number">7.1.2</span> Constructing the adaptive bandwidth gwr model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>bw_adaptive <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/model/bw_analysis_adaptive.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>gwr_adaptive <span class="ot">&lt;-</span> <span class="fu">gwr.basic</span>(<span class="at">formula =</span> resale_price <span class="sc">~</span> floor_area_sqm <span class="sc">+</span> remaining_lease <span class="sc">+</span> X01_to_03 <span class="sc">+</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>                            X04_to_06 <span class="sc">+</span> X07_to_09 <span class="sc">+</span> X10_to_12 <span class="sc">+</span> X13_to_15 <span class="sc">+</span> X16_to_18 <span class="sc">+</span> X19_to_21 <span class="sc">+</span></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>                            X22_to_24 <span class="sc">+</span> X25_to_27 <span class="sc">+</span> X28_to_30 <span class="sc">+</span> X31_to_33 <span class="sc">+</span> X34_to_36 <span class="sc">+</span> X37_to_39 <span class="sc">+</span> </span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>                            X40_to_42 <span class="sc">+</span> X43_to_45 <span class="sc">+</span> New_Generation <span class="sc">+</span> Improved <span class="sc">+</span> Model_A <span class="sc">+</span> Simplified <span class="sc">+</span> </span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>                            Standard <span class="sc">+</span> Premium_Apartment <span class="sc">+</span> DBSS <span class="sc">+</span> distance_to_eldercare <span class="sc">+</span> distance_to_food <span class="sc">+</span> </span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>                            distance_to_mrt <span class="sc">+</span> distance_to_park <span class="sc">+</span> distance_to_mall <span class="sc">+</span> distance_to_supermarkets <span class="sc">+</span> </span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>                            nb_of_kindergartens <span class="sc">+</span> nb_of_childcare <span class="sc">+</span> nb_of_bus_stops <span class="sc">+</span> nb_of_primary_schools, </span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data =</span> rp_analysis.sp, <span class="at">bw=</span>bw_adaptive, <span class="at">kernel =</span> <span class="st">'gaussian'</span>, <span class="at">adaptive=</span><span class="cn">TRUE</span>, </span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">longlat =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(gwr_adaptive, <span class="st">"data/model/gwr_analysis_adaptive.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>gwr_adaptive <span class="ot">=</span> <span class="fu">read_rds</span>(<span class="st">"data/model/gwr_analysis_adaptive.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>gwr_adaptive</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="dropping-geometry" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="dropping-geometry"><span class="header-section-number">7.2</span> Dropping geometry</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>coords_train <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(rp_analysis.sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(coords_train, <span class="st">"data/model/coords_train.rds"</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>coords_train <span class="ot">=</span> <span class="fu">read_rds</span>(<span class="st">"data/model/coords_train.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>rp_analysis.no_geom <span class="ot">=</span> rp_analysis.sf <span class="sc">%&gt;%</span> </span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">22</span><span class="sc">:</span><span class="dv">23</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="calibrating-random-forest-model" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="calibrating-random-forest-model"><span class="header-section-number">7.3</span> Calibrating Random Forest Model</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>rp_analysis.no_geom <span class="ot">=</span> rp_analysis.no_geom <span class="sc">%&gt;%</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2410</span>)</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>rf <span class="ot">&lt;-</span> <span class="fu">ranger</span>(resale_price <span class="sc">~</span> floor_area_sqm <span class="sc">+</span> remaining_lease <span class="sc">+</span></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>               x01_to_03 <span class="sc">+</span> x04_to_06 <span class="sc">+</span> x07_to_09 <span class="sc">+</span> x10_to_12 <span class="sc">+</span> x13_to_15 <span class="sc">+</span> </span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>               x16_to_18 <span class="sc">+</span> x19_to_21 <span class="sc">+</span> x22_to_24 <span class="sc">+</span> x25_to_27 <span class="sc">+</span> x28_to_30 <span class="sc">+</span> </span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>               x31_to_33 <span class="sc">+</span> x34_to_36 <span class="sc">+</span> x37_to_39 <span class="sc">+</span> x40_to_42 <span class="sc">+</span> x43_to_45 <span class="sc">+</span> </span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>               new_generation <span class="sc">+</span> improved <span class="sc">+</span> model_a <span class="sc">+</span> simplified <span class="sc">+</span> standard <span class="sc">+</span> </span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a>               premium_apartment <span class="sc">+</span> dbss <span class="sc">+</span> distance_to_eldercare <span class="sc">+</span> </span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a>               distance_to_food <span class="sc">+</span> distance_to_mrt <span class="sc">+</span> distance_to_park <span class="sc">+</span> </span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a>               distance_to_mall <span class="sc">+</span> distance_to_supermarkets <span class="sc">+</span> nb_of_kindergartens <span class="sc">+</span></span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a>               nb_of_childcare <span class="sc">+</span> nb_of_bus_stops <span class="sc">+</span> nb_of_primary_schools, </span>
<span id="cb141-11"><a href="#cb141-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">data =</span> rp_analysis.no_geom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="calibrating-geographical-random-forest-model" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="calibrating-geographical-random-forest-model"><span class="header-section-number">7.4</span> Calibrating Geographical Random Forest Model</h2>
<section id="calibrating-using-training-data" class="level3" data-number="7.4.1">
<h3 data-number="7.4.1" class="anchored" data-anchor-id="calibrating-using-training-data"><span class="header-section-number">7.4.1</span> Calibrating using training data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>gwRF_adaptive <span class="ot">&lt;-</span> <span class="fu">grf</span>(<span class="at">formula =</span> resale_price <span class="sc">~</span> floor_area_sqm <span class="sc">+</span> remaining_lease <span class="sc">+</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>                       x01_to_03 <span class="sc">+</span> x04_to_06 <span class="sc">+</span> x07_to_09 <span class="sc">+</span> x10_to_12 <span class="sc">+</span> x13_to_15 <span class="sc">+</span> </span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>                       x16_to_18 <span class="sc">+</span> x19_to_21 <span class="sc">+</span> x22_to_24 <span class="sc">+</span> x25_to_27 <span class="sc">+</span> x28_to_30 <span class="sc">+</span> </span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>                       x31_to_33 <span class="sc">+</span> x34_to_36 <span class="sc">+</span> x37_to_39 <span class="sc">+</span> x40_to_42 <span class="sc">+</span> x43_to_45 <span class="sc">+</span> </span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>                       new_generation <span class="sc">+</span> improved <span class="sc">+</span> model_a <span class="sc">+</span> simplified <span class="sc">+</span> standard <span class="sc">+</span> </span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a>                       premium_apartment <span class="sc">+</span> dbss <span class="sc">+</span> distance_to_eldercare <span class="sc">+</span> </span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a>                       distance_to_food <span class="sc">+</span> distance_to_mrt <span class="sc">+</span> distance_to_park <span class="sc">+</span></span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a>                       distance_to_mall <span class="sc">+</span> distance_to_supermarkets <span class="sc">+</span> nb_of_kindergartens <span class="sc">+</span></span>
<span id="cb143-9"><a href="#cb143-9" aria-hidden="true" tabindex="-1"></a>                       nb_of_childcare <span class="sc">+</span> nb_of_bus_stops <span class="sc">+</span> nb_of_primary_schools,</span>
<span id="cb143-10"><a href="#cb143-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">dframe=</span>rp_analysis.no_geom, <span class="at">bw=</span>bw_adaptive, <span class="at">kernel=</span><span class="st">"adaptive"</span>,</span>
<span id="cb143-11"><a href="#cb143-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">coords=</span>coords_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(gwRF_adaptive, <span class="st">"data/model/gwRF_adaptive250.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>gwRF_adaptive <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/model/gwRF_adaptive.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="testing" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Testing</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz.sf)<span class="sc">+</span></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>()<span class="sc">+</span></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(rp_3rooms.sf)<span class="sc">+</span></span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"blue"</span>)<span class="sc">+</span></span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(<span class="fu">st_buffer</span>(rp_3rooms.sf, <span class="dv">350</span>))<span class="sc">+</span></span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"red"</span>,</span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha =</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>rp_3rooms.sf <span class="sc">%&gt;%</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">st_distance</span>(rp_3rooms.sf, kindergartens.sf) <span class="sc">&lt;=</span> <span class="dv">350</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>spatialrisk<span class="sc">::</span><span class="fu">concentration</span>(rp_3rooms.sf, kindergartens.sf,</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">value =</span> count, <span class="at">radius =</span> <span class="dv">350</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>